Use Testing to Drive Design Decisions Chapters 8 and 9 describe practices for continuously testing infrastructure code as people work on changes. This heavy focus on testing makes testability an essential design consideration for infrastructure components. Your change delivery system needs to be able to create and test infrastructure code at every level, from a server configuration module that installs a monitoring agent, to stack code that builds a container cluster. Pipeline stages must be able to quickly create an instance of each component in isolation. This level of testing is impossible with a spaghetti codebase with tangled dependencies, or with large components that take half an hour to provision. These challenges derail many initiatives to introduce effective automated testing regimes for infrastructure code. It’s hard to write and run automated tests for a poorly designed system. And this is the secret benefit of automated testing: it drives better design. The only way to continuously test and deliver code is to implement and maintain clean system designs with loose coupling and high cohesion. It’s easier to implement automated testing for server configuration modules that are loosely coupled. It’s easier to build and use mocks for a module with cleaner, simpler interfaces (see “Using Test Fixtures to Handle Dependencies”). You can provision and test a small, well-defined stack in a pipeline more quickly.
テストを使用して設計決定を促進する チャプター8と9では、変更を加える際にインフラストラクチャのコードを継続的にテストするための手法について説明します。このテストに対する重点的な取り組みは、テスト可能性をインフラストラクチャのコンポーネントの重要な設計考慮事項にします。変更配信システムは、モニタリングエージェントをインストールするサーバー構成モジュールからコンテナクラスタをビルドするスタックコードまで、あらゆるレベルのインフラストラクチャコードを作成しテストする能力を持つ必要があります。パイプラインステージは各コンポーネントのインスタンスを独立してすばやく作成できる必要があります。スパゲッティコードベースで絡まり合った依存関係を持つ場合や、30分かかる大きなコンポーネントを使っては、このレベルのテストは不可能です。これらの課題が多くのインフラストラクチャコードの効果的な自動テスト体制の導入を妨げます。設計が不十分なシステムに対して自動テストを作成して実行するのは困難です。そして、これが自動テストの秘密のメリットです：それはより良い設計を推進します。コードを継続的にテストして配信する唯一の方法は、緩い結合と高い凝集度を持つクリーンなシステム設計を実装し維持することです。緩い結合度を持つサーバー構成モジュールに対して自動化されたテストを実装するのは容易です。よりクリーンでシンプルなインターフェースを持つモジュールに対しては、モックをビルドして使用するのも簡単です（「依存関係の処理にテストフィクスチャを使用する」を参照）。パイプラインで小さくて明確に定義されたスタックを供給してテストすることも、より迅速に行えます。