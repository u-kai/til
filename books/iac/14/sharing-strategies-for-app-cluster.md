Sharing Strategies for Application Clusters How many clusters should you run, how big should they be, and how much should you run on each? In theory, you could run a single cluster, manifesting environments and other application boundaries within the cluster instance. However, there are many reasons why a single cluster may not be practical:4 Managing changes You need to update, upgrade, fix, and change your cluster. So at the least, you need somewhere to test these changes that won’t interrupt services. For disruptive changes, like those that require or risk downtime, scheduling a time that meets the needs of all teams, applications, and regions is challenging. Running multiple clusters makes it easier to schedule maintenance windows, and reduces the impact of a failed change. Segregation Many clustering implementations don’t provide strong enough segregation between applications, data, and configuration. You may also have different governance regimes for the cluster implementation based on the services running on it. For example, services that handle credit card numbers may have stricter compliance requirements, so running them on a separate cluster simplifies the requirements for your other clusters. Configurability Some applications or teams have different configuration requirements for the clusters they use. Providing them with separate cluster instances reduces configuration conflict. Performance and scalability Clustering solutions have different scaling characteristics. Many don’t cope with higher latency, which makes it impractical to run a single cluster across geographical regions. Applications may hit resource limitations or contention issues with one another when they scale up on a single cluster. Availability A single cluster is a single point of failure. Running multiple clusters can help cope with various failure scenarios.
There are a few potential strategies for sizing and sharing cluster instances. To choose the right strategy for your system, consider your requirements for change segregation, configurability, performance, scale, distribution, and availability. Then test your application clustering solution against those requirements. One Big Cluster for Everything A single cluster can be simpler to manage than multiple clusters. The likely exception is in managing changes. So at a minimum, you should use at least one separate cluster instance to test changes, using a pipeline to deploy and test cluster configuration changes there before applying them to your production cluster. Separate Clusters for Delivery Stages You can run different clusters for different parts of your software delivery process. Doing this could be as simple as running one cluster per environment (see Figure 14-10).
A dedicated cluster for every environment avoids inconsistencies you might get from having applications from multiple environments sharing resources. However, it may be difficult and expensive to maintain a separate instance for every delivery stage. For instance, if your delivery process dynamically creates test instances, you may need to dynamically create cluster instances to run them, which can be very slow.
A variation of separating clusters by delivery stage is to share clusters across multiple stages. For example, you might use different clusters based on governance requirements. In Figure 14-11, there are three clusters. The DEV cluster is for development, running instances where people create and use various data sets for more exploratory testing scenarios. The NON-PROD cluster is for more rigorous delivery stages, with managed test data sets. The PROD cluster hosts the PREPROD and PROD environments, both of which contain customer data and so have more rigorous governance requirements. Figure 14-11. Cluster instances shared across multiple environments When hosting multiple environments in a shared cluster, you should aim to keep each environment segregated as much as possible. Ideally, applications and operational services should not be able to see or interact with instances from other environments. Many of the mechanisms that application clustering
solutions provide for separating applications are “soft.” For instance, you may be able to tag instances to indicate the environment, but this is purely a convention. You should look for stronger methods to segregate applications.
アプリケーションクラスターの共有戦略 アプリケーションクラスターはいくつ実行すべきですか？それらはどれくらいのサイズであるべきですか？また、それぞれに何を実行すべきですか？理論的には、単一のクラスターを実行し、その中で環境や他のアプリケーションの境界を表現することができます。しかし、単一のクラスターが実用的でない理由はいくつかあります。変更の管理 変更の更新、アップグレード、修正、および変更が必要です。したがって、少なくとも、これらの変更を中断することなくテストできる場所が必要です。ダウンタイムを必要とする変更などの中断的な変更の場合、すべてのチーム、アプリケーション、および地域のニーズを満たす時間をスケジュールすることは困難です。複数のクラスターを実行することで、メンテナンスウィンドウのスケジュールが容易になり、失敗した変更の影響を軽減することができます。区分化 多くのクラスタリングの実装は、アプリケーション、データ、および設定の間に十分な区分を提供しません。また、クラスターの実装に基づいて異なるガバナンス体制を持つ場合もあります。たとえば、クレジットカード番号を処理するサービスは、より厳格なコンプライアンス要件があるため、別々のクラスターで実行することで他のクラスターの要件を簡素化することができます。設定可能性 一部のアプリケーションやチームは、使用するクラスターに異なる設定要件を持っています。それらに独立したクラスターインスタンスを提供することで、設定の競合を減らすことができます。パフォーマンスとスケーラビリティ クラスタリングソリューションには異なるスケーリング特性があります。多くのソリューションは、より高いレイテンシに対応できないため、地理的な地域にわたって単一のクラスターを実行することは実用的ではありません。アプリケーションは、単一のクラスターでスケールアップすると、リソース制限や競合問題に直面する場合があります。可用性 単一のクラスターは単一障害点です。複数のクラスターを実行することで、さまざまな障害シナリオに対応できます。 クラスターインスタンスのサイズと共有のためのいくつかの戦略があります。システムに適切な戦略を選択するためには、変更の区分化、設定可能性、パフォーマンス、スケール、分散、可用性の要件を考慮する必要があります。その後、アプリケーションクラスタリングソリューションをそれらの要件に対してテストする必要があります。 すべてのものに1つの大きなクラスター 単一のクラスターは、複数のクラスターよりも管理が簡単である場合があります。変更を管理する場合を除きます。したがって、最小限にして、少なくとも1つの別個のクラスターインスタンスを使用して変更をテストし、クラスターの構成変更を本番クラスターに適用する前にそこでデプロイおよびテストするためのパイプラインを使用する必要があります。 配信ステージごとに個別のクラスター 異なる配信プロセスの各パートごとに別々のクラスターを実行することができます。これは、環境ごとに1つのクラスターを実行するだけで簡単にできるかもしれません。複数の環境からリソースを共有することによる一貫性の欠如を避けるために、各環境ごとに専用のクラスターを保持することが最適です。しかし、各配信ステージごとに個別のインスタンスを維持することは困難かつ高価になる場合があります。たとえば、配信プロセスがテストインスタンスを動的に作成する場合、それらを実行するために動的にクラスターインスタンスを作成する必要があり、非常に遅くなる可能性があります。配信ステージごとにクラスターを別々にするバリエーションとしては、ガバナンスの要件に基づいて異なるクラスターを使用することがあります。 図14-1-11には、3つのクラスターがあります。 DEVクラスターは開発用であり、人々がさまざまなデータセットを作成し、使用してより探索的なテストシナリオを実行するインスタンスが実行されています。 NON-PRODクラスターはより厳格な配信ステージ用で、管理されたテストデータセットが含まれています。 PRODクラスターはPREPRODおよびPRODの環境をホストし、いずれも顧客データを含んでおり、より厳格なガバナンスの要件を持っています。図14-11クラスターインスタンスが複数の環境で共有される場合、できるだけ各環境を分離することが理想です。理想的には、アプリケーションとオペレーションサービスは、他の環境のインスタンスを表示または操作できないようにする必要があります。アプリケーションクラスタリングソリューションがアプリケーションの分離のために提供するメカニズムの多くは「ソフト」です。たとえば、インスタンスに環境を示すタグを付けることができるかもしれませんが、これは純粋な規約です。アプリケーションを分離するためのより強力な方法を探すべきです。