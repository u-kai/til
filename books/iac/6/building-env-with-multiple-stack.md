Building Environments with Multiple Stacks The reusable stack pattern describes an approach for implementing multiple environments. In Chapter 5 I described different ways of structuring a system’s infrastructure across multiple stacks (see “Patterns and Antipatterns for Structuring Stacks”). There are several ways you can implement your stacks to combine these two dimensions of environments and system structure. The simple case is implementing the complete system as a single stack. When you provision an instance of the stack, you have a complete environment. I depicted this in the diagram for the reusable stack pattern (Figure 6-5). But you should split larger systems into multiple stacks. For example, if you follow the service stack pattern (“Pattern: Service Stack”) you have a separate stack for each service, as shown in Figure 6-6.
To create multiple environments, you provision an instance of each service stack for each environment, as shown in Figure 6-7.
You would use commands like the following to build a full environment with multiple stacks:
Chapter 15 describes strategies for splitting systems into multiple stacks, and Chapter 17 discusses how to integrate infrastructure across stacks.
Conclusion Reusable stacks should be the workhorse pattern for most teams who need to manage large infrastructures. A stack is a useful unit for testing and delivering changes. It provides assurance that each instance of an environment is defined and built consistently. The comprehensiveness of a stack, rather than modules, as a unit of change enhances the ability to easily deliver changes quickly and frequently.
複数のスタックを使った環境の構築 リユーザブルスタックパターンは、複数の環境を実装するためのアプローチを説明しています。第5章では、システムのインフラストラクチャを複数のスタックに分けるさまざまな方法について説明しました（「スタックの構造化のためのパターンと反パターン」を参照）。これらの2つの次元、つまり環境とシステムの構造を組み合わせるために、いくつかの方法でスタックを実装できます。単純な場合は、完全なシステムを単一のスタックとして実装します。スタックのインスタンスをプロビジョニングすると、完全な環境が得られます。これは再利用可能なスタックパターンの図（図6-5）で示しました。しかし、大きなシステムは複数のスタックに分割するべきです。たとえば、サービススタックパターン（「パターン：サービススタック」）に従う場合、各サービスに対して個別のスタックがあります（図6-6参照）。
複数の環境を作成するには、各環境ごとに各サービススタックのインスタンスをプロビジョニングします（図6-7参照）。
次のようなコマンドを使用して、複数のスタックを持つ完全な環境を構築します。
第15章では、システムを複数のスタックに分割するための戦略について説明し、第17章では、スタック間でのインフラストラクチャの統合方法について説明しています。
結論 リユーザブルスタックは、大規模なインフラストラクチャを管理する必要があるほとんどのチームにとって、中心となるパターンです。スタックは、変更のテストとデリバリーに便利な単位です。環境の各インスタンスが一貫して定義され、構築されていることを保証します。モジュールではなく、スタックを変更の単位とする包括性により、変更を迅速かつ頻繁に提供する能力が向上します。