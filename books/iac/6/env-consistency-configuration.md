Environments, Consistency, and Configuration Since multiple environments are meant to run instances of the same system, the infrastructure in each environment should be consistent. Consistency across environments is one of the main drivers of Infrastructure as Code. Differences between environments create the risk of inconsistent behavior. Testing software in one environment might not uncover problems that occur in another. It’s even possible that software deploys successfully in some environments but not others. On the other hand, you typically need some specific differences between environments. Test environments may be smaller than production environments. Different people may have different privileges in different environments. Environments for different customers may have different features and characteristics. At the very least, names and IDs may be different (appserver-test, appserver-stage, appserver-prod). So you need to configure at least some aspects of your environments. A key consideration for environments is your testing and delivery strategy. When the same infrastructure code is applied to every environment, testing it in one environment tends to give confidence that it will work correctly in other environments. You don’t get this confidence if the infrastructure varies much across instances, however. You may be able to improve confidence by testing infrastructure code using different configuration values. However, it may not be practical to test many different values. In these situations, you may need additional validation, such as post-provisioning tests or monitoring production environments. I’ll go more in-depth on testing and delivery in Chapter 8.
環境、一貫性、および設定
複数の環境は同じシステムのインスタンスを実行するため、各環境のインフラストラクチャは一貫している必要があります。環境間の一貫性は「インフラストラクチャ・コード (IaC)」の主要な要素です。環境間の違いは、一貫しない動作のリスクを生み出します。1つの環境でソフトウェアをテストしても、別の環境で発生する問題を見つけることはありません。また、ソフトウェアが一部の環境では正常にデプロイされても、他の環境では正常にデプロイされないこともあります。

一方で、環境間には特定の違いが必要な場合もあります。テスト環境は本番環境よりも小規模である場合があります。異なる人々が異なる環境で異なる権限を持つこともあります。異なる顧客の環境には異なる機能と特性がある場合もあります。最低限、名前やIDが異なる場合もあります (appserver-test、appserver-stage、appserver-prod)。そのため、環境の少なくとも一部の側面を設定する必要があります。

環境に対する重要な考慮事項は、テストとデリバリー戦略です。同じインフラストラクチャコードをすべての環境に適用する場合、1つの環境でテストすることで、他の環境でも正しく動作するという信頼性を得る傾向があります。ただし、インスタンス間でインフラストラクチャが大きく異なる場合、この信頼性は得られません。異なる設定値を使用してインフラストラクチャコードをテストすることで、信頼性を向上させることもできるかもしれません。ただし、多くの異なる値をテストすることは実用的ではない場合もあります。このような状況では、プロビジョニング後のテストや本番環境の監視など、追加の検証が必要になる場合があります。テストとデリバリーについては、第8章で詳しく説明します。