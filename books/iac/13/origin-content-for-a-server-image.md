Origin Content for a Server Image Several elements come together for building server images: Image builder code You write code to define the image, which your builder tool uses. A Packer template file is one example. This code defines the other elements to assemble into the image. Origin source image In many cases, you build an image starting with another image. You may need a source image in your platform’s format, like an AMI. Or it may be an operating system installation image, whether physical like a DVD or data like an ISO image. In some cases, you build the image from scratch, such as when you run an OS installer. Each of these is described in more detail later. Server configuration code You may use a server configuration tool or scripts to customize the image, as explained in the previous section. Other sever elements You may use any or all of the elements, and sources of those elements, described in “What’s on a Server” to build your server image. It’s common to use packages from public or internal repositories when building images. This set of elements comes into play when you use a pipeline to automate the image building process, as described later in this chapter. Types of origin source images are worth some more specific attention. Building from a Stock Server Image Infrastructure platform vendors, operating system vendors, and open source projects often build server images and make them available to users and customers. As mentioned earlier, many teams use these stock images directly rather than building their own. But when you do build your own, these images are usually a good starting point.
One issue with stock images is that many of them are over-provisioned. Makers often install a wide variety of tools and packages, so that they are immediately useful to the broadest number of users. But you should minimize what you install on your custom server images, both for security and for performance. You can either strip unneeded content from the origin image as part of your server image configuration process or find smaller origin images. Some vendors and organizations build JEOS (Just Enough Operating System) images. Adding the things you need to a minimal base image is a more reliable approach for keeping your images minimal. Building a Server Image from Scratch Your infrastructure platform may not provide stock images, especially if you use an internal cloud or virtualization platform. Or, your team may simply prefer not to use a stock image. The alternative is to build custom server images from scratch. An OS installation image gives you a clean, consistent starting point for building a server template. The template building process starts by booting a server instance from the OS image and running a scripted installation process.5 Provenance of a Server Image and its Content Another concern with base images, as with any content from third parties, is their provenance and security. You should be sure you understand who provides the image, and the process they use to ensure that they build the images safely. Some things to consider: Do images and packages include software with known vulnerabilities? What steps does the vendor take to scan their code for potential problems, such as static code analysis? How do you know whether any included software or tools collect data in ways that contradict your organizational policies or local laws? What processes does the vendor use to detect and prevent illicit tampering, and do you need to implement anything on your end, such as checking package signatures? You shouldn’t completely trust the content that comes from a vendor or third party, so you should implement your own checks. “Test Stage for a Server Image” suggests how to build checking into a pipeline for server images.
サーバーイメージの元コンテンツ
サーバーイメージを構築するためには、いくつかの要素が組み合わさる必要があります：イメージビルダーコード イメージを定義するためのコードを作成し、それをビルダーツールが使用します。パッカーテンプレートファイルが一つの例です。このコードは、イメージに組み立てる他の要素を定義します。起源のソースイメージ 多くの場合、他のイメージを元にイメージを構築します。AMIのようなプラットフォームのフォーマットでソースイメージが必要な場合もあります。または、DVDのような物理的なオペレーティングシステムのインストールイメージやISOイメージのようなデータもあります。一部の場合では、OSインストーラーを実行するときのように、イメージをゼロから構築します。それぞれについては、後のセクションで詳しく説明します。サーバーの設定コード 以前のセクションで説明したように、サーバーの設定ツールやスクリプトを使用してイメージをカスタマイズすることがあります。その他のサーバーの要素 サーバーイメージを構築するために、「サーバーの内容」で説明されている要素とその要素のソースを任意またはすべて使用することがあります。イメージの構築プロセスを自動化するパイプラインを使用する場合、これらの要素のセットが使用されます。後の章で説明します。起源のソースイメージのタイプには、特定の注意が必要です。在庫のサーバーイメージからの構築 インフラストラクチャプラットフォームのベンダー、オペレーティングシステムのベンダー、オープンソースプロジェクトは、しばしばサーバーイメージを構築し、ユーザーや顧客に提供します。前述したように、多くのチームはこれらの在庫イメージを直接使用しますが、自分自身で構築することもあります。ただし、個別のイメージはしばしば過剰に提供されているという問題もあります。製造業者は、一般のユーザーがすぐに利用できるように、さまざまなツールやパッケージをインストールすることがよくあります。ただし、セキュリティとパフォーマンスのために、カスタムサーバーイメージにはインストールするコンテンツを最小限に抑える必要があります。サーバーイメージの構成プロセスで、元のイメージから不要なコンテンツを削除するか、より小さな元のイメージを見つけることができます。一部のベンダーや組織は、Just Enough Operating System（JEOS）イメージを構築しています。必要なものを最小限のベースイメージに追加する方法は、イメージを最小限に保つための信頼性のある手段です。ゼロからサーバーイメージを構築する インフラストラクチャプラットフォームが在庫イメージを提供しない場合、特に内部のクラウドや仮想化プラットフォームを使用している場合は、カスタムサーバーイメージをゼロから構築することもできます。OSのインストールイメージは、サーバーテンプレートを構築するためのクリーンで一貫性のある出発点を提供します。テンプレート構築プロセスは、OSイメージからサーバーインスタンスを起動し、スクリプトされたインストールプロセスを実行することから始まります。サーバーイメージおよびそのコンテンツの信頼性 買いイメージなどのベースイメージに関するもう一つの懸念事項は、その起源とセキュリティです。イメージを提供する個人や組織を理解し、イメージを安全に構築するためのプロセスを理解する必要があります。以下の事柄に留意する必要があります：イメージやパッケージには既知の脆弱性のあるソフトウェアが含まれていませんか？ベンダーは、静的コード解析など、潜在的な問題をスキャンするための手順を講じていますか？含まれているソフトウェアやツールが組織のポリシーや地方の法律に反する方法でデータを収集するかどうかを知る方法はありますか？ベンダーは、不正な改ざんを検出および防止するためのプロセスを使用し、パッケージの署名のチェックなど、自分自身で実装する必要がありますか？ベンダーや第三者から提供されるコンテンツを完全に信頼してはいけませんので、独自のチェックを実装する必要があります。