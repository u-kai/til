Integrating Projects As mentioned in “Organizing Projects and Repositories”, projects within a codebase usually have dependencies between them. The next question is when and how to combine different versions of projects that depend on each other. As an example, consider several of the projects in the ShopSpinner team’s codebase. They have two stack projects. One of these, application_infrastructure-stack, defines the infrastructure specific to an
application, including a pool of virtual machines and load balancer rules for the application’s traffic. The other stack project, shared_network_stack, defines common networking shared by multiple instances of application_infrastructure-stack, including address blocks (VPC and subnets) and firewall rules that allow traffic to application servers. The team also has two server configuration projects, tomcat-server, which configures and installs the application server software, and monitor-server, which does the same for a monitoring agent. The fifth infrastructure project, application-server-image, builds a server image using the tomcat-server and monitor-server configuration modules (see Figure 19-3).
The application_infrastructure-stack project creates its infrastructure within networking structures created by shared_network_stack. It also uses server images built by the application-server-image project to create servers in its application server cluster. And application-server-image builds server images by applying the server configuration definitions in tomcat-server and monitor-server.
When someone makes a change to one of these infrastructure code projects, it creates a new version of the project code. That project version must be integrated with a version of each of the other projects. The project versions can be integrated at build time, delivery time, or apply time. Different projects of a given system can be integrated at different points, as illustrated by the ShopSpinner example in the following pattern descriptions. Linking and Integrating Combining the elements of a computer program is referred to as linking. There are parallels between linking and integrating infrastructure projects as described in this chapter. Libraries are statically linked when building an executable file, similarly to build-time project integration. Libraries installed on a machine are dynamically linked whenever a call is made from an executable, which is somewhat like apply-time project integration. In both cases, either the provider or the consumer can be changed to a different version in the runtime environment. The analogy is imperfect, as changing a program affects an executable’s behavior, while changing infrastructure (generally speaking) affects the state of resources.
プロジェクトの統合
「プロジェクトとリポジトリの組織化」で説明されているように、コードベース内のプロジェクトには通常、相互依存関係があります。次の質問は、お互いに依存する異なるバージョンのプロジェクトをいつ、どのように組み合わせるかということです。例として、ShopSpinnerチームのコードベースのいくつかのプロジェクトを考えてみましょう。彼らには2つのスタックプロジェクトがあります。そのうちの1つであるapplication_infrastructure-stackは、アプリケーション固有のインフラストラクチャを定義しています。これには、仮想マシンのプールやアプリケーションのトラフィックのためのロードバランサールールが含まれます。もう1つのスタックプロジェクトであるshared_network_stackは、application_infrastructure-stackの複数のインスタンス間で共有されるネットワーキングを定義しており、VPCやサブネットのアドレスブロック、アプリケーションサーバーへのトラフィックを許可するファイアウォールルールなどが含まれます。チームにはまた、2つのサーバー設定プロジェクト、tomcat-serverとmonitor-serverもあります。tomcat-serverはアプリケーションサーバーソフトウェアを設定してインストールし、monitor-serverは監視エージェントのために同じことをします。5番目のインフラストラクチャプロジェクトであるapplication-server-imageは、tomcat-serverとmonitor-serverの設定モジュールを適用してサーバーイメージを作成します（図19-3を参照）。
application_infrastructure-stackプロジェクトは、shared_network_stackで作成されたネットワーキング構造内にインフラストラクチャを作成します。また、application-server-imageプロジェクトで構築されたサーバーイメージを使用して、アプリケーションサーバークラスター内のサーバーを作成します。そして、application-server-imageは、tomcat-serverとmonitor-serverのサーバー設定定義を適用してサーバーイメージを構築します。
これらのインフラストラクチャコードプロジェクトのいずれかに変更が加えられると、プロジェクトコードの新しいバージョンが作成されます。そのプロジェクトバージョンは、他の各プロジェクトのバージョンと統合する必要があります。プロジェクトのバージョンはビルド時、配信時、または適用時に統合することができます。与えられたシステムの異なるプロジェクトは、ShopSpinnerの例で説明されているパターンの説明に示されているように、異なるタイミングで統合できます。リンキングと統合は、コンピュータプログラムの要素を組み合わせることを意味します。この章で説明されているように、インフラストラクチャプロジェクトの統合にはリンキングとの類似点があります。ライブラリは、実行可能ファイルをビルドする際に静的にリンクされますが、ビルド時のプロジェクト統合と同様です。マシンにインストールされたライブラリは、実行可能ファイルからの呼び出し時に動的にリンクされます。これは、適用時のプロジェクト統合のようなものです。どちらの場合でも、プロバイダまたはコンシューマーをランタイム環境で別のバージョンに変更することができます。この類似性は完全ではありませんが、プログラムの変更は実行可能ファイルの動作に影響を与えますが、インフラストラクチャの変更（一般的には）はリソースの状態に影響を与えます。