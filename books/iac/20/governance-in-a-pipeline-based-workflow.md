Governance in a Pipeline-based Workflow Governance is a concern for most organizations, especially larger ones and those that work in regulated industries like finance and health care. Some people see governance as a dirty word that means adding unneeded friction to getting useful work done. But governance just means making sure things are done responsibly, according to the organization’s policies. Chapter 1 explained that quality — governance being an aspect of quality — can enable delivery speed and that the ability to deliver changes quickly can improve quality (see “Use Infrastructure as Code to Optimize for Change”.) Compliance as Code13 leverages automation and more collaborative working practices to make this positive loop work.
Reshuffling Responsibilities Defining systems as code creates opportunities to reshuffle the responsibilities of the people involved in working on infrastructure (the people listed in “The People”) and the way those people engage with their work. Some factors that create these opportunities are: Reuse Infrastructure code can be designed, reviewed, and reused across multiple environments and systems. You don’t need a lengthy design, review, and signoff exercise for each new server or environment if you use code that has already been through that process. Working code Because code is quick to write, people can review and make decisions based on working code and example infrastructure. This makes for faster and more accurate feedback loops than haggling over diagrams and specifications. Consistency Your code creates environments far more consistently than humans following checklists. So testing and reviewing infrastructure in earlier environments gives faster and better feedback than doing these later in the process. Automated testing Automated testing, including for governance concerns like security and compliance, gives people working on infrastructure code fast feedback. They can correct many problems as they work, without needing to involve specialists for routine issues. Democratize quality People who aren’t specialists can make changes to the code for potentially sensitive areas of infrastructure, such as networking and security policies. They can use tools and tests created by specialists to sanity check their changes. And specialists can still review and approve changes before they’re applied to production systems. Reviewing this way is more efficient because the specialist can directly view code, test reports, and working test instances.
Governance channels The infrastructure codebase, and pipelines used to deliver changes to production instances, can be organized based on their governance requirements. So a change to security policies goes through a review and signoff step not necessarily required for changes to less sensitive areas. Many of the ways we can change how people manage systems involve shifting responsibilities left in the process. Shift Left Chapter 8 explains principles and practices for implementing automated testing and pipelines to deliver code changes to environments. The term shift left describes how this impacts workflows and delivery practices. Code is rigorously tested during implementation, at the “left” end of the flow shown in most process diagrams. So organizations can spend less time on heavyweight processes at the “right” end, just before applying code to production. People involved in governance and testing focus on what happens during implementation, working with teams, providing tools, and enabling practices to test early and often. An Example Process for Infrastructure as Code with Governance ShopSpinner has a reusable stack (“Pattern: Reusable Stack”) that it can use to create the infrastructure for an application server to host an instance of its service for a customer. When someone changes the code for this stack, it can affect all of its customers. Its technical leadership group, which is responsible for architectural decisions, defines CFRs (as described in “What Should We Test with Infrastructure?”) that the application server infrastructure must support. These CFRs include the number and frequency of orders that users can place on a customer instance, the response times for the interface, and recovery times for server failures.
The infrastructure team and the application team join with a pair of Site Reliability Engineers (SREs) and a QA to implement some automated tests that check the performance of the application server stack against the CFRs. They build these tests into the several stages of the pipeline, progressively testing different components of the stack (as per “Progressive Testing”). Once the group has these tests in place, people don’t need to submit infrastructure changes for review by the technical leadership group, SREs, or anyone else. When an engineer changes the networking configuration, for example, the pipeline automatically checks whether the resulting infrastructure still meets the CFRs before they can apply it to production customer instances. If the engineer makes a mistake that breaks a CFR, they find out within minutes when a pipeline stage goes red and can immediately correct it. In some cases, a change may cause a problem with a customer instance that isn’t caught by the automated tests. The group can conduct a blameless postmortem to review what happened. Perhaps the problem was that none of the CFRs covered the situation, so they need to change or add a CFR to their list. Or their testing may have a gap that missed the issue, in which case they improve the test suite. Normalize Your Emergency Fix Process Many teams have a separate process for emergency changes so that they can deliver fixes quickly. Needing a separate process for faster fixes is a sign that the normal change process could be improved. An emergency change process speeds things up in one of two ways. One is to leave out unnecessary steps. The other is to leave out necessary steps. If you can safely leave a step out in an emergency, when the pressure is on and the stakes are high, you can probably leave it out of your normal process. If skipping a step is unacceptably risky, then find a way to handle it more efficiently and do it every time.14

パイプラインベースのワークフローにおけるガバナンス
ガバナンスは、金融や医療などの規制産業で働く特に大規模な組織を含め、ほとんどの組織にとって懸念事項です。一部の人々は、ガバナンスという言葉を、有用な仕事の進行に不要な摩擦を引き起こすと捉えています。しかし、ガバナンスは単に、組織のポリシーに従って責任を持って事を行うことを意味します。第1章では、品質 - ガバナンスが品質の一側面であることが、デリバリースピードを実現することができるし、変更を迅速に行う能力は品質を向上させることができることを説明しています（「変更の最適化のためにインフラストラクチャをコード化する」を参照）。コンプライアンスのコード化は、このポジティブなループを作動させるために、自動化およびより協業的な作業方法を活用します。

役割の再配置
コードとしてシステムを定義することにより、インフラストラクチャに関与する人々の責任を再配置する機会が生まれます（「関係者」にリストされた人々とその人々が業務に関与する方法も同様です）。これらの機会を生み出す要因のいくつかは以下の通りです。
再利用
インフラストラクチャのコードは、複数の環境やシステムで設計、レビュー、再利用することができます。既にそのプロセスを経ているコードを使用すれば、新しいサーバーや環境ごとに長々とした設計、レビュー、承認手続きは必要ありません。
動作するコード
コードは迅速に作成することができるため、人々は動作するコードやインフラストラクチャの例を基にレビューを行い、意思決定をすることができます。これにより、図や仕様について議論するよりも、より速くかつ正確なフィードバックループが形成されます。
一貫性
コードによる環境の作成は、チェックリストに従っている人間よりも遥かに一貫性があります。そのため、より早期の環境でインフラストラクチャをテストおよびレビューすることは、後段のプロセスに比べてより速く、より良いフィードバックを提供します。
自動化されたテスト
セキュリティやコンプライアンスなどのガバナンスに関する自動化されたテストにより、インフラストラクチャコードに取り組む人々は迅速なフィードバックを得ることができます。彼らは、例外的な問題について専門家を巻き込む必要なく、作業中に多くの問題を修正することができます。
品質を民主化する
専門知識を持たない人々は、ネットワーキングやセキュリティポリシーなど、インフラストラクチャの潜在的に敏感な領域のコードを変更することができます。彼らは専門家が作成したツールやテストを使用して、変更の正当性を確認することができます。そして、専門家は変更が本番システムに適用される前に引き続きレビューおよび承認を行うことができます。このようなレビュー方法は、専門家がコード、テストレポート、および作動テストインスタンスを直接確認できるため、より効率的です。

ガバナンスチャンネル
インフラストラクチャコードベースと本番インスタンスへの変更の提供に使用されるパイプラインは、それらのガバナンス要件に基づいて組織化することができます。したがって、セキュリティポリシーの変更は、それ以外の敏感でない領域の変更では必ずしも要求されない手続きとしてレビューおよび承認のステップを経る必要があります。システムの管理方法を変更する多くの方法は、プロセス内の責任を左にシフトさせることによって実現されます。

左シフト
第8章では、自動化されたテストとコード変更を環境に提供するためのパイプラインを実装するための原則と実践について説明しています。左シフトという用語は、これがワークフローやデリバリーの方法にどのように影響するかを示しています。コードは、ほとんどのプロセスダイアグラムに表示される「左」のフローの終わりで厳密にテストされます。そのため、組織は本番コードを適用する直前の「右」のエンドでの重いプロセスに費やす時間を削減することができます。ガバナンスとテストに関与する人々は、実装中に何が起こっているかに焦点を当て、チームと協力して、ツールを提供し、早期かつ頻繁にテストを行うための手法を可能にします。

ガバナンスを伴ったインフラストラクチャのコード化の例
ShopSpinnerは再利用可能なスタック（「パターン：再利用可能なスタック」）を持っており、このスタックを使用して顧客のためのアプリケーションサーバーのインフラストラクチャを作成することができます。このスタックのコードが変更されると、全ての顧客に影響を及ぼす可能性があります。アーキテクチャの意思決定に責任を持つ技術リーダーグループは、アプリケーションサーバーのインフラストラクチャがサポートする必要があるCFR（「インフラストラクチャには何をテストすべきか？」で説明）を定義します。これらのCFRには、ユーザーが顧客インスタンスに対して配置できる注文の数と頻度、インターフェースの応答時間、サーバーの障害時の復旧時間などが含まれます。

インフラストラクチャチームとアプリケーションチームは、サイト信頼性エンジニア（SRE）のペアとQAと協力して、アプリケーションサーバースタックのパフォーマンスをCFRに対してテストするいくつかの自動化テストを実装します。彼らはこれらのテストをパイプラインの複数のステージに組み込み、スタックの異なるコンポーネントを逐次テストします（「プログレッシブテスト」に従って）。このグループがこれらのテストを導入すると、インフラストラクチャの変更を技術リーダーグループやSREなどにレビューしてもらう必要がありません。例えば、エンジニアがネットワーキングの構成を変更する場合、パイプラインは自動的に生成されたインフラストラクチャがCFRを引き続き満たしているかどうかをチェックします。もしエンジニアがCFRを破るようなミスを comits した場合、パイプラインのステージが赤になると数分以内に知ることができ、すぐに修正できます。いくつかの場合、変更によって自動化テストでは検知できない顧客インスタンスの問題が発生するかもしれません。その場合、グループは問題を見直し、何が起こったかをレビューするための責任を追うことができます。おそらく、問題がCFRにカバーされていなかったためである場合、CFRを変更または追加する必要があります。または、問題を見逃していたテストにギャップがあるかもしれません。その場合は、テストスイートを改善します。

緊急修正プロセスを正常化する
多くのチームは、修正を迅速に提供するために別個のプロセスを持っています。緊急修正を迅速に行うためには、通常の変更プロセスを改善する必要があるサインです。緊急修正プロセスは、2つの方法で速度を上げることができます。1つは不要なステップを省くこと、もう1つは必要なステップを省くことです。緊急時に安全にステップを省略できる場合は、通常のプロセスからそれを省略することができます。ステップを省略することが受け入れられないほどリスクが高い場合は、より効率的に取り扱い、毎回行う方法を見つける必要があります。