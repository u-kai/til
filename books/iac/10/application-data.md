Application Data Data is often an afterthought for deploying and running applications. We provision databases and storage volumes but, as with many parts of infrastructure, it’s making changes to them that turns out to be hard. Changing data and structures is time consuming, messy, and risky. Application deployment often involves creating or changing data structures, including converting existing data when structures change. Updating data structures should be a concern of the application and application deployment process, rather than the infrastructure platform and runtime. However, the infrastructure and application runtime services need to support maintaining data when infrastructure and other underlying resources change or fail. See “Data Continuity in a Changing System” for ways to approach this challenge. Data Schemas and Structures Some data storage is strictly structured, such as SQL databases, while others are unstructured or schema-less. A strictly structured, schema-driven database enforces structures on data, refusing to store incorrectly formatted data. Applications that use a schema-less database are responsible for managing the data format.
A new application release may include a change to data structures. For a schema-driven database, this involves changing the definition of the data structures in the database. For example, the release may add a new field to data records, a classic example being splitting a single “name” field into separate fields for first, middle, and last name. When data structures change, any existing data needs to be converted to the new structure with either type of database. If you are splitting a “name” field, you will need a process that divides the names in the database into their separate fields. Changing data structures and converting data is called schema migration. There are several tools and libraries that applications and deployment tools can use to manage this process, including Flyway, DBDeploy, Liquibase, and db-migrate.5 Developers can use these tools to define incremental database changes as code. The changes can be checked into version control, and packaged as part of a release. Doing this helps to ensure that database schemas stay in sync with the application version deployed to an instance. Teams can use database evolution strategies to safely and flexibly manage frequent changes to data and schemas. These strategies align with Agile software engineering approaches, including CI and CD, as well as Infrastructure as Code.6 Cloud Native Application Storage Infrastructure Cloud native infrastructure is dynamically allocated to applications and services on demand. Some platforms provide cloud native storage as well as compute and networking. When the system adds an application instance, it can automatically provision and attach a storage device. You specify the storage requirements, including any formatting or data to be loaded when it is provisioned, in the application deployment manifest (see Example 10-2). Example 10-2. Example of an application deployment manifest with data storage application:
name: db_cluster
compute_instance:
memory: 2 GB
container_image: db_cluster_node_application
storage_volume:
size: 50 GB
volume_image: db_cluster_node_volume This simple example defines how to create nodes for a dynamically scaled database cluster. For each node instance, the platform will create an instance of the container with the database software, and attach a disk volume cloned from an image initialized with an empty database segment. When the instance boots, it will connect to the cluster and synchronize data to its local volume.
Application Data Data（アプリケーションデータ）は、アプリケーションの展開と実行においてしばしば後回しにされるものです。私たちはデータベースとストレージボリュームをプロビジョニングしますが、インフラストラクチャの多くの部分と同様に、それらを変更することが困難であることが判明します。データと構造の変更は、時間がかかり、乱雑で、リスクが伴うものです。アプリケーションの展開には、既存のデータが変更された場合を含む、データ構造の作成や変更が必要とされることがよくあります。データ構造の更新は、インフラストラクチャの場所やランタイムではなく、アプリケーションとアプリケーション展開プロセスの関心事であるべきです。ただし、インフラストラクチャおよびアプリケーションのランタイムサービスは、インフラストラクチャや他の基礎リソースが変更または失敗した場合にデータを維持するためのサポートを提供する必要があります。この課題に取り組む方法については、「変化するシステムにおけるデータ継続性」を参照してください。 データスキーマと構造 一部のデータストレージは厳格に構造化されており、SQLデータベースなどが該当しますが、他のものは非構造化またはスキーマのないものです。スキーマに基づいた厳密に構造化されたデータベースは、データに対して構造を強制し、正しくフォーマットされていないデータの保存を拒否します。スキーマのないデータベースを使用するアプリケーションは、データ形式の管理に責任を負います。
新しいアプリケーションリリースには、データ構造の変更が含まれる場合があります。スキーマに基づいたデータベースの場合、これにはデータ構造の定義を変更することが含まれます。たとえば、リリースがデータレコードに新しいフィールドを追加することがあります。典型的な例としては、単一の「名前」フィールドを名前、ミドルネーム、姓の別々のフィールドに分割するものです。データ構造が変更されると、いずれのデータベースでも既存のデータを新しい構造に変換する必要があります。 「名前」フィールドを分割する場合は、データベース内の名前を個々のフィールドに分割するプロセスが必要です。データ構造の変更とデータの変換をスキーママイグレーションと呼びます。 Flyway、DBDeploy、Liquibase、db-migrateなど、いくつかのツールやライブラリがあります。これらのツールを使用して、アプリケーションと展開ツールはこのプロセスを管理することができます。変更はバージョン管理ツールにチェックインし、リリースの一部としてパッケージ化することができます。これにより、データベーススキーマがインスタンスに展開されたアプリケーションバージョンと同期していることが保証されます。チームは、データとスキーマへの頻繁な変更を安全かつ柔軟に管理するためのデータベース進化戦略を使用することができます。これらの戦略は、CIやCD、およびインフラストラクチャとしてのコードなど、アジャイルソフトウェアエンジニアリングの手法に合致しています。 クラウドネイティブアプリケーションストレージインフラストラクチャ クラウドネイティブインフラストラクチャは、アプリケーションとサービスに動的に割り当てられます。一部のプラットフォームは、計算とネットワークだけでなく、クラウドネイティブストレージも提供しています。システムがアプリケーションインスタンスを追加すると、ストレージデバイスを自動的にプロビジョニングしてアタッチできます。アプリケーションの展開マニフェスト（例10-2を参照）で、プロビジョニング時にロードするフォーマットやデータを含むストレージ要件を指定します。 この単純な例では、動的にスケーリング可能なデータベースクラスタのノードの作成方法が定義されています。各ノードインスタンスのプラットフォームは、データベースソフトウェアを利用したコンテナのインスタンスを作成し、空のデータベースセグメントで初期化されたイメージからクローンされたディスクボリュームをアタッチします。インスタンスが起動すると、クラスタに接続し、データをローカルボリュームに同期します。