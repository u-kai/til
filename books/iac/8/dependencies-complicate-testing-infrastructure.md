Challenge: Dependencies Complicate Testing Infrastructure The time needed to set up other infrastructure that your code depends on makes testing even slower. A useful technique for addressing this is to replace dependencies with test doubles. Mocks, fakes, and stubs are all types of test doubles. A test double replaces a dependency needed by a component so you can test it in isolation. These terms tend to be used in different ways by different people, but I’ve found the definitions used by Gerard Meszaros in his book xUnit Test Patterns (Addison-Wesley) to be useful.9
In the context of infrastructure, there is a growing number of tools that allow you to mock the APIs of cloud vendors.10 You can apply your infrastructure code to a local mocked cloud to test some aspects of the code. These won’t tell you whether your networking structures work correctly, but they should tell you whether they’re roughly valid. It’s often more useful to use test doubles for other infrastructure components than for the infrastructure platform itself. Chapter 9 gives examples of using test doubles and other test fixtures for testing infrastructure stacks (see “Using Test Fixtures to Handle Dependencies”). Later chapters in Part IV describe breaking infrastructure into smaller pieces and integrating them. Test fixtures are a key tool for keeping components loosely coupled.
チャレンジ：依存関係はテストインフラストラクチャを複雑にします。コードが依存関係を持つ他のインフラストラクチャのセットアップに必要な時間は、テストをより遅くします。この問題に対処する有用なテクニックは、テストダブルで依存関係を置き換えることです。モック、フェイク、スタブは、すべてテストダブルの種類です。テストダブルは、コンポーネントが必要とする依存関係を置き換えて、それを孤立してテストできるようにします。これらの用語は、異なる人々によって異なる方法で使用される傾向がありますが、私はGerard Meszarosの著書「xUnit Test Patterns」（Addison-Wesley）で使用されている定義が有用であると考えています。

インフラストラクチャの文脈では、クラウドベンダーのAPIをモックするためのツールが増えています。このモッククラウドにインフラストラクチャコードを適用して、コードの一部をテストすることができます。これにより、ネットワーキング構造が正しく動作するかどうかはわかりませんが、おおまかには正当であるかどうかを知ることができます。インフラストラクチャプラットフォーム自体よりも、他のインフラストラクチャコンポーネントにテストダブルを使用することの方がより役立つことが多いです。第9章では、テストダブルと他のテストフィクスチャを使用してインフラストラクチャスタックをテストする例が示されています（「依存関係の処理にテストフィクスチャを使用する」を参照）。パートIVの後の章では、インフラストラクチャをより小さな部品に分割し、それらを統合する方法が説明されています。テストフィクスチャは、コンポーネントの緩やかな結合を保つための重要なツールです。