# テストの声を聴く

-   Date に依存するものを明示的に外から撮るようにしてテストをしやすくしている

    -   もともと内部構造に隠蔽していいた Date が明示的になることを悪く考える人もいるが，テストしやすくなっただけではなく，時刻の依存関係が明示的なったことで，時刻に関するバグが発見しやすくなる

-   コードを組み立てるテクニックとしてのオブジェクト思考の目標の一つは，それぞれのオブジェクトの境界を明確に可視化するということ
    -   オブジェクトが扱う値やインスタンスはローカル(自信のスコープで生成し，管理しているもの)なものか，明示的に渡されたものだけでなければならない
    -   上の Date 例では，日付の検査をテストしやすくするという行為によって Receiver の要件がより明示的になり，そのドメインについてより明確に考えざるを得なくなった

## 値はモックしない

-   値は不変のため，単にインスタンス作成して使えばいい
-   あるクラスがモックする価値のない値であるかどうかを判別する経験則
    -   まず最初にその値が不変であること
        -   ただし，これはその値が調整オブジェクトの可能性もある
    -   次にその型を表すインターフェイスを実装したクラスに適切な名前が思い浮かばないこと
        -   仮に Video がインターフェイスだとして，その実装クラスの名前に VideoImpl などのぼんやりしたもの以外をつけることができるかどうか
-   値のモックを作りたくなる理由が，インスタンス作成が難しすぎる性であるならビルダーを書くことを検討する

## 肥大化したコンストラクタ

-   TDD をしていく過程で依存関係を追加していくとコンストラクタへの引数が多くなることがある
-   この傾向自体は悪くないが，コードを綺麗にする必要はある
-   外に引き出せる暗黙の構造が隠れていないかを探すことになる

-   一つの可能性として引数のうちのいくつかを一つの概念にまとめることができ，それを新しいオブジェクトに置き換えられるかもしれない
-   暗黙のコンポーネントを抽出する時にはまず次の二つの条件を探す
    -   クラス内で常に同時に使われている引数はないか
    -   そして生存期間の同じ引数はないか
-   条件を満たすものが見つかったら，より難しい，その概念をうまく説明する名前を考える
    -   設計がうまくいっていることを表す一つの兆候はこの手の変更を組み込みやすいということ

## テストが教えてくれること

-   知識をローカルに保つ

    -   裏技を使わないとモックを作成できない場合のように，コンポーネント間で知識が漏洩しているものがある
    -   知識をローカルに保つことができれば，その実装はコンテキストに依存しなくなり，どこでも安全に動かせるようになる

-   明示的にすれば名前をつけることができる

    -   具象クラスのモックを作りたくない理由の一つはオブジェクト間の関連に名前をつけづらいから
    -   オブジェクトそのものでなく，オブジェクト間の関連にも名前をつけるのが良い

-   名前をつければつけるほどドメイン情報が増える

    -   オブジェクト自体が何者であるかと言うことよりも，それが他のオブジェクトにどのようにやり取りするのかに注目すれば実装レベルではなくドメインの観点からオブジェクトの型やロールを定義できるようになる
    -   これは，小さな抽象化を数多く行うことで，もとのプログラミング言語から離れることができるから
    -   そしてドメインのボキャブラリをより多くコードに取り入れることようになる

-   データではなく振る舞いを流す
    -   尋ねるな，命じよの方針を常に適用することを心がけると，値をスタックに積むのではなく，振る舞いをシステムに渡すようなコーディングスタイルになる
    -   インターフェイスが明確であるほど，よりよい情報隠蔽と明確な抽象化ができるようになる
