# テストの柔軟性

-   システムやそれに関連するテストスイートが成長するにつれてテストが注意深く書かれていないと保守の負担となる時がある
-   前の章で説明していた，テストの運用コストを下げるための方法は，テストの可読性を上げることと，テストが失敗した時に有用な診断メッセージを生成すること
-   さらに重要なことは，個々のテストは関係のあるコードが壊れている時にだけ失敗するようにしておくこと
-   テストが脆くなる一般的な要因

    -   テストがシステム上の無関係なパーツやテスト対象オブジェクトの無関係な振る舞いと密に結合しすぎている
    -   テストが対象コードに期待する振る舞いを必要以上に指定しており，必要以上の制約を課している
    -   テストに重複があり複数のテストがプロダクションコードの同じ振る舞いを実行している

-   テストの脆さは単にそのテストの書き方だけに起因するものではなく，システム自体の設計にも関わる問題

    -   あるオブジェクトがその環境から切り離せない理由が依存関係が多すぎたり，隠されてしまったりする性であると，そのオブジェクトのテストは遠く離れたところにある他の部分が変更された時にも失敗する
    -   そうなるとコードを書き換えた時に効果がどこまで波及するのかを判断するのが難しくなる

-   テストの可読性と弾力性は大いに関係がある
    -   あるテストを見た時に焦点が絞られており，準備段階がスッキリまとまっていてそして重複が最小限に抑えられていれば名前もつけやすく，その目的も明確になる
    -   つまり，何が起こるべきなのかを正確に指定し，余計なことは一切しないこと
    -   こうしたことを正確にすればするほどコードは柔軟になり，関係のない部分を変更しても誤ってもテストを壊してしまうことがなくなる
    -   テストの柔軟性を保つことで得られるもう一つの恩恵はテストの内容を理解しやすくなると言うこと
    -   なぜなら何をテストしているのかが明確になっており，テストされる側のコードにおいて，何が重要で何が重要でないかがはっきりするから

## 情報の表現ではなく，中身をテストする

-   テストはオブジェクト間でやり取りされる情報の中身の観点で書くべきものであって，その情報の表現方法に依存してはいけない
-   情報の中身の観点で書いておけば，テストはよりわかりやすくなり，システムの他の部分で実装が変更された場合にも影響が少なくなる
-   NO_CUSTOMER_FOUND のように重要な値は定数として 1 箇所にまとめておくべき
-   さらに複雑なデータ構造については，その表現方法の詳細をテストデータビルダーに隠蔽することができる
