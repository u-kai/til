# 設計の意義と設計への向き合い方

## 本書はなんの設計について書いたものなのか

- ソフトウェア製品における主な品質特性としては以下

| 品質特性     | 説明                                         | 品質副特性                                     |
| ------------ | -------------------------------------------- | ---------------------------------------------- |
| 機能適合性   | 機能がニーズを満たす度合                     | 機能完全性，機能正確性，機能適切性             |
| 性能効率性   | リソース効率や性能の度合い                   | 時間効率性，資源効率性，容量満足性             |
| 互換性       | 他のシステムと情報の共有，交換ができる度合い | 共存性，相互運用性                             |
| 使用性       | 利用者がシステムを満足に利用できる度合い     | アクセシビリティ，UI 快美性,習得性             |
| 信頼性       | 必要な時に機能実行できる度合い               | 成熟性，可用性，回復性                         |
| セキュリティ | 不正利用から保護する度合い                   | 機密性，否認防止性，責任追従性，真正性         |
| 保守性       | システムを修正する有効性や効率の度合い       | モジュール性，再利用性，解析性，修正性，試験性 |
| 移植性       | 他の実行環境に移植できる度合い               | 適応性，設置性，置換性                         |

- 本書は保守性に重きを置いて書かれていることになる
  - 保守性の中でも特に変更容易性の向上を目的にした設計手法

## 設計しないと開発生産性が低下する

- 悪魔を呼び寄せるコードとは変更容易性が低いコード
- 変更が困難で壊れやすいコードをレガシーコードと呼び，レガシーコードが蓄積している状態を技術的負債と呼ぶ

  - 別の本ではテストコードのないコードはレガシーコードだ！と述べている本もある
  - 別のことを言っているが，現実は本書も上記の本も，対象となるレガシーコードに大きな違いはなさそう
    - 要は，壊れやすいコードかつ，テストコードがない技術的負債は多そう

- 変更容易性を保持しないと開発生産性が低下する
- 要因は主に 2 つ

1. バグを埋め込みやすくなる
   - コード変更時にバグを埋め込みやすくなる
   - バグを修正するのに時間がかかってしまう
1. 可読性が低下する
   - 意図を正確に理解するまでに時間がかかる

- 所感
  - 正直精神面の疲弊もある気がする
  - 変更がしづらいコードはイライラするし，追記していく気持ちがしない

### 木こりのジレンマ

- 刃がボロボロだから木を切れないが，その暇がないと言うジレンマ
- これは面白いし，ソフトウェア以外でも多い
- おそらく時間がかかっても刃を研ぐしかない

### 一生懸命仕事した感覚だけが残って生産性は悪いまま

- 開発生産性が悪いと，新機能をなかなかリリースできずに，成果を出せない体質になる
- リリースに間に合わせようと長時間労働が慢性化する
- 一生懸命働く，でも，変更しにくいから成果が出ない
- 本当にやるべきことは成果を出しやすい構造を設計すること

- 所感
  - これは本当にそう
  - DogMans でもとにかく間に合わせようと実装ばかりやって(TDD ではないということ)，結局変更しにくい，わかりにくい構造になった
  - そのせいで，どんどん実装が難しくなり，精神的にもキツくなった
  - 落ち着いて TDD から少しずつやることで構造とわかりやすさが改善され，よくなっていった
  - またこれは別の話

### 国家規模の経済損失

- レガシーコードによる実装遅延が一人につき 1 日 3 時間，メンバーが 20 人だと,一年間で 14400 時間の損失がある

  - 時給 1000 円でも 1 千万越え，そしてエンジニアが時給 1000 円ポッキリなわけがない

- しかもレガシーコードの影響は比例ではなく，もっと加速度がある
- 経済産業省の発表によると，2025 年以降の技術的負債は 12 兆円の試算

## ソフトウェアとエンジニアの成長性

- 変更が容易だと，ソフトウェアの成長性を高めることができる
- 変更用意性が悪化すると，ソフトウェアの成長性は悪化するし，エンジニアとしてのスキル成長も悪化する

### エンジニアにとっての資産とは何か

- 本質的なエンジニアにとっての資産は技術力
- レガシーコードは技術力の成長を妨げてしまう恐ろしい存在

### レガシーコードに人はひきづられやすい

- 新入社員は先輩のコードにひきづられやすい

  - 尚且つそれが悪いものとは思わない

- レガシーコードはレガシーコードの書き手を育ててしまう

- 所感
  - 後輩を意識してコードは書きたいと思いました．．．

### レガシーコードは高品質設計を妨げる

- レガシーコードはアンバランスでトリッキーな実装であることが多い
- 設計改善が非常に困難
- プロジェクトの納期等の都合により，設計改善を諦めてしまうことが多い

### レガシーコードは開発工数を減少させる

- レガシーコードの理解に時間が取られてしまう

## 課題を解決する

### 課題が見えないとそもそも設計する意識が生まれない

### 知覚容易な課題と知覚困難な課題がある

- 技術的負債はマイナスの価値だが，システムの外からは見えない

  - 内部のコードのため

- エンジニアがコードに対する知識を持っていないと，課題が知覚できない

### 理想系を知って初めて課題を知覚できる

- 理想がわかっていればそこに向かって進むだけ
- 理想がわからずに進むのは理想ではない方向に進む可能性があるので，実は危険
- 課題とは理想と現状のギャップ
- そのため理想を知っておくことは大切
- そこが始まりとなることもある

### 変更容易性を比較できないジレンマ

- ソフトウェア開発を比較したり，計測するのは大変難しい
- 所感
  - おそらくそれぞれのコンテキストや忙しさなどが変わるから
  - そして，比較は比較したいもの以外同じにしないといけないが，ソフトウェアだとそれがむずい
  - でも Lean 本にもあった，相関があったケイパビリティは計測するのが良さそう

## コードの良し悪しを判断する指標

- コードの複雑さや，可読性などの一連の品質特性をコードメトリクス，またはソフトウェアメトリクスと呼ぶ

### 実行可能コードの行数

- スコープないの行数が多いと複雑なことをやっている可能性があると言うもの
- 関数であれば十行，クラスであれば百行以内，と言ったもの
  - もちろん，プロジェクトや言語によって調整されるもの

### 循環的複雑度(サイクロマティック複雑度)

- コードの構造的な複雑さを示す指標
- 条件分岐やループ処理が増える，ネストすると複雑せさは増大する

### 凝集度

### 結合度

### チャンク

- 筆者がよく意識するものらしい
- 人間の短期記憶は一度に 4±1 個の概念しか把握できないと言う説がある
- この個数をマジカルナンバー 4 と呼ぶ
- また記憶個数の単位をチャンクと呼ぶ
- クラスを設計するときはマジカルナンバー 4 を採用して脳に優しい構造を心がける
- クラス内部で取り扱う概念が 4±1 に治るように設計し，大きいクラスは小さいクラスに分割すること

## 設計対象と費用対効果

- 設計やリファクタリングは無限にできない．予算／時間は有限なため
- こうしたコスト制約のある中で，費用対効果が高い設計やリファクタリングをするべき

### パレートの法則(80:20 の法則)

- これはソフトウェアの機能でも言えるはず
  - 仕様変更頻度に関しても重要

### サービス中心的領域，コアドメイン

- どのサービスにもウリとなるコアドメインがある
- コアドメインは以下のように説明される

  - システム内で最大の価値を付加すべき場所
  - 価値があり重要度，費用対効果が最大の箇所
  - 競争優位性があり，差別化が図られ，ビジネス上優位に立つポイント

- まさに設計にコストをかけるべき箇所，費用帯効果が高い箇所と言える

### 重点設計対象の選定にはビジネス知識が必要

- 機能追加が多くされると，どれがコアドメインかわからなくなる
- サービスの事業領域に関して深い知識を持っている人をドメインエキスパートといい，このドメインエキスパートと協力し，何がコアドメインなのかを見定める必要があると言う教えがドメイン駆動設計
- 設計の費用対効果を高めには重点的な設計対象の選定が必要
- そしてその選定にはサービスが解決したい顧客課題は何か，サービスの本質は何かを見通す力が必要
- つまりサービスのビジネス知識が必須になる
- 構造の良し悪しだけに着目しているとビジネス戦略上，設計がうまく働かない
- 成長性を高める最適な設計とビジネス知識には切っても離せない関係にある

## 時間を操る超能力者になろう
