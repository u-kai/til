# 7 サービスの粒度

-   この本での言葉の定義
-   モジュール性

    -   システムを個別のパーツに分解すること

-   粒度

    -   上記のパーツの大きさ

-   適切な粒度(サービスの大きさ)を決定する作業はアーキテクトや開発チームが常に頭を悩ませているハードパーツ
-   メトリクスとしては総ステートメント数や，公開インターフェイスやオペレーションの数
-   サービスの粒度に関しては粒度分解要因と粒度統合要因という 2 つの対立する力がある

-   粒度分解要因

    -   どのような場合にサービスを小さく分解することを検討すべきか

-   粒度統合要因

    -   どのような場合にサービスをまとめることを検討すべきか

-   上記 2 つの力を均衡させることが大事

## 粒度分解要因

-   サービスをより小さな断片に分割するタイミングの指針と根拠を提供する
-   主な要因

    -   サービスの範囲と機能
        -   サービスが多くの関連性のないことをしすぎていないか
    -   コード変動率
        -   変更がサービスの一部分だけに隔ってないか？
    -   スケーラビリティとスループット
        -   サービスの一部が異なるスケーリングをするかどうか
    -   耐障害性
        -   サービスの中で重要な機能が故障するようなエラーはないか？
    -   セキュリティ
        -   サービスの一部に他よりも高いセキュリティレベルが必要となるか?
    -   拡張性
        -   サービスは常に新しいコンテキストを追加して拡張されていくか？

## サービスの範囲と機能

-   マイクロサービスアーキテクチャではマイクロサービスを単一目的を持ち，個別にデプロイされる 1 つのことをうまくこなすソフトウェアの単位と定義している
-   何が単一の責任であり，何が単一の責任ではないのかという主観的な問題がサービスの粒度に関して多くの開発者が頭を悩ませる
-   適切な粒度を決定するのにはこれ以外のことも含めて考える必要がある

## 粒度統合要因

-   主な要因
    -   データベーストランザクション
        -   サービスを跨いだ ACID トランザクションが必要か
    -   ワークフローとこレオグラフィ
        -   サービス同士がやりとりする必要があるのか？
    -   共有コード
        -   サービス間でコードを共有する必要があるか
    -   データ関係
        -   サービスが分解できたとして，そのサービスが利用するデータも分解できるのか？


