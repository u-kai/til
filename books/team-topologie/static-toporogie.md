# 静的なチームトポロジー

- できる限り効果的なチームにするには，ただ偶発的で行き当たりばったりなチーム編成をするのではなく，継続的にチームを設計する必要がある
- このお湯に継続的な設計によるチーム構造のことをチームトポロジーと呼ぶ
  - これはそれぞれのチームの責任範囲を明確にしながら，組織内にチームを意図的に配置することを意味する

## チームのアンチパターン

- 場当たり的なチーム設計

  - 大きくなり過ぎてコミュニケーションのオーバヘッドのせいで壊れてしまったチーム
  - 商用ソフトウェアやミドルウェアの面倒をまとめて見るために作られたチーム
  - データベースの扱いが雑で本番環境でソフトウェアがクラッシュした後に作られたデータベース管理チームなどが含まれる
  - いずれの状況でもなんらかの対応は必要だが，チーム間の相互関係という大きなコンテキストを考慮しないと，当然に思えるソリューションのせいでデリバリーが遅くなったり，チームの自立性が失われたりする可能性がある

- チームメンバーの入れ替え

  - 非常に不安定なチームをプロジェクトベースで作って，プロジェクトが終わったらすぐに解散というもの
  - アプリケーションのメンテナンスフェーズに 1 人か 2 人を残して全員いなくなるようなもの
  - 柔軟性が高く，納期に向けて素早く進められると思うかもしれないが，新しいチームを立ち上げたり，頻繁にコンテキストスイッチしたりするコストを見落としている
  - もしくはそのコストを無意識にプロジェクトの見積もりに含めている

- 組織は以下の質問をすることで意図的にチームを設計しなければいけない
  - 自分たちのスキル，制約，文化とエンジニアリングの成熟度，望ましいソフトウェアアーキテクチャー，ビジネスゴールを踏まえると，素早く安全に成果を出すにはどのチームタイプが役に立つか
  - 主な変更フローにおいて，チーム間の引き継ぎを無くしたり減らしたりするにはどうすれば良いか？
  - システムを実行可能に維持しつつ，早いフローを促進する上でソフトウェアシステムの境界をどこに設定すべきか？
  - チームはどうそれに合わせれば良いか？

## 変更フローを考慮した設計

- 大規模なソフトウェアシステムの構築，運用を行う組織は，コンセプトから動作するソフトウェアに至るまでの変更フローを重視した低摩擦な組織設計をしている
- 様々な部署にまたがる職能型サイロ，アウトソーシングの多用，チーム間で繰り返される引き継ぎといった古い組織モデルでは顧客やマーケットの状況に日々対応し，サービスを継続的に進化させるのに必要となる速度を安全に実現することはできないし，組織的なフィードバックメカニズムは得られない

### フローとセンシングを可能にするチーム間コミュニケーションの形成

- 多くの組織にはソフトウェアシステムを構築，運用するときのチーム間のインタラクションの方法に重大な欠陥がある
- 具体的にはそのような組織はソフトウェアのデリバリーを使用から設計，設計からコーディング，コーディングからテストとリリース，リリースから通常業務へと続く一方通このプロセスだと思い込んでいる
- 段階別に分担する職能型サイロの本で直線的かつ段階的な変更を行うのは，現代のソフトウェアシステムの変化の速さや複雑度と全く違う
- ソフトウェア開発プロセスにおいて，本番環境でのソフトウェアの動きから学べることはほとんど，もしくは全くないと考えるのは，根本的に間違っている
- 反対に，ソフトウェア開発チームが本番環境で動作しているソフトウェアのに触れられるような組織では，サイロ化した，競合他社と比べてユーザーの目に見えるような問題や運用上の問題をより素早く見つけられる
- デリバリ担当チームが職能上の枠に縛られず，同一のチーム内でシステムの設計．開発，テスト，デプロイ，運用を行うのに必要なスキルを全て兼ね備えていなければいけない
- 本番システムからの情報のフィードバックに価値を置く組織はソフトウェアを素早く改善できるだけでなく，顧客やユーザーへの対応力も高まる
- 現場のスタッフやチームは組織が扱うマーケットや環境に関するとても価値あるシグナルの情報源だと考えるべし

  - そうすることで優れたセンシング能力が得られるようになる

- このようなセンシング能力を組織の最前線にいるストリームあらインドチームだけでなく，様々なチームが備えることで，プラットフォーム，サービス，インターフェイスの問題を素早く発見し，早くその問題に対して IT 全体の有効性を高めるための戦略的能力を飛躍的に高めることができる

## DevOps と DevOps トポロジー

- DevOps トポロジーカタログはチーム設計とインタラクションに関するパターンとアンチパターンのオンラインコレクションでチームの責任範囲，インターフェイス，技術チーム間のコラボレーションについての会話を始めるのに役立つ
- DevOps の成功パターンは組織やプロダクトの規模，技術的な成熟度や共通のゴールなどのコンテキストによって大きく異なるというのが肝
- このトポロジーは企業におけるソフトウェアデリバリーチームの構成を検討するときに役立つ参考資料となる

  - しかしこれは決して静的な構造ではなく，デリバリーするプロダクトの種類，技術リーダーシップ，運用経験といった複数の要因の影響を受けたある瞬間を描いたもの
  - チームは時間と共に進化し，変化するというのが暗黙の了解

- DevOps トポロジーには 2 つの重要な考えが反映されている
  - 1 つ目は DevOps を成功させるためのチームを構成するアプローチには万能のものはないということ
  - 2 つ目は DevOps の成功を妨げるアンチパターンとなるような DevOps の心情に反したり無視したりするようなトポリジーもあること
  - つまり，組織にとって正しいトポロジーはないが，悪いトポロジーは複数ある

## 成功しているチームのトポロジー

### フィーチャーチームはエンジニアリングにおける高い成熟度と信頼を必要とする

- フィーチャーチームとは職能横断型かつコンポーネント横断型のチームのことで，顧客向けの機能のアイデア検討から構築までを一貫して行い，顧客に提供し，理想的には使用状況やパフォーマンスを監視できるチームを指す
- 職能横断型なフィーチャーチームはコンポーネントを横断して顧客中心の機能を素早くリリースすることで，組織に高い価値をもたらす
- その速度は複数のコンポーネントチームがそれぞれに変更を加えて 1 つのリリースにまとめるよりもかなり早い
- だが，これができるのはフィーチャーチームが自給自足，つまり，他のチームを待つことなく機能を本番にリリースできる場合に限る
- フィーチャーチームは通常複数のコードベースを触る必要があり，そのオーナーシップは他のコンポーネントチームにあることもある
- チームのエンジニアリングの成熟度が高くない場合，ユーザーの新しいワークフローのテストを自動化しなかったり，ボーイスカウトルールに従わなかったりといった近道をしてしまう

  - これによって時間と共に技術的負債が増えデリバリーの速度が落ちるにつれて，チーム間の信頼が壊れていく

- またチーム間の規律が保たれていないまま複数のチームが同じコードベースを扱うと，その悪影響が蓄積していき，共有コードに対するオーナーシップの欠如につながることがある
- フィーチャーチームのおかげで，チーム間のコミュニケーションや依存関係は大幅に減る
  - 一方で必要な UX，性能，信頼性を満たした上で，確実にシステムが統合されて動作するように，誰かがシステム全体に目を光らせなければいけなかった
  - そこでシステムアーキテクト，システムオーナー，統合リードなどの個別の役割が作られた
  - 重要なのは，こういった役割の人たちがプロジェクトや組織全体を横断して，コミュニケーションの同線のように働き，フィーチャーチームと直接かつ頻繁にやり取りすること
  - 彼らはインターフェイスや統合といったサブシステムにまたがる問題をサポートし，定期的な機能のデリバリーを維持できるようにする

### プロダクトチームはサポートシステムを必要とする

- プロダクトチームの目的や特徴はフィーチャーチームと同じだが，1 つかそれ以上のプロダクトの機能全体を担当するという点が異なる
- プロダクトチームは自分たちの成果をエンドユーザーに提供する上で，イン裏ストラクチャー，プラットフォーム，テスト環境，ビルドシステム，デリバリーパイプラインなどに依存する
- これらの依存関係のうちいくつかは自分たちでやるが，チームの認知や専門知識には限界があるので，他の人たちの助けが必要なこともある
- チームが自律的でいるのに必要なのは，外部への依存関係をノンブロッキングにすること

  - すなわち，新機能はできているのに，外部の何かを待っているということがないにする

- ノンブロッキングな依存関係は他のチームが開発，維持するセルフサービス型の能力という形をとることが多い

  - テスト環境の払い出し，デプロイパイプラインの作成，監視など
  - プロダクトチームはこれらを必要に応じて独立して使うことができる

- 簡単に使えるサービス(プラットフォーム指向のアプローチが望ましい)やチームが不慣れなタスクを行うときにすぐに頼れるスペシャリストといったサポートシステムがないままにプロダクトチームを作ると，多くのボトルネックを作り出す
- プロダクトチームは結局，インフラストラクチャーやネットワーク，QA などの職能型チームに対する強い依存関係を持たなければいけなくなる
-

### クラウドチームはアプリケーション用のインフラストラクチャーは作らない

- クラウドチームが今の振る舞いやインフラストラクチャーのプロセスをそのまま続けると，組織は以前と同じようにソフトウェアデリバリーの遅延やボトルネックに悩まされる
- プロダクトチームは必要に応じて新しいイメージやテンプレートを作り，自分たちの環境やリソースをプロビジョニングできる自立性が必要
- クラウドチームはプロビジョニングプロセスを引き続き担当し，必要な管理やポリシーの適用，監査が確実に行われるようにする
- だがクラウドチームはプロダクトチームのニーズと適切なリスクおよびコンプライアンス管理のニーズに合うような，高品質のセルフサービスを提供することに注力すべき
- つまり，クラウドインフラストラクチャーのプロセスを設計する責任とアプリケーションに必要なリソースを実際にプロビジョニングしたり更新したりする責任を分離する必要がある

### SRE は大規模でこそ意味がある

## トポロジーを選択する場合に考慮すること

### 技術的成熟度と文化的成熟度

### 組織のサイズ，ソフトウェアの規模，エンジニアリングの成熟度

- 成熟度の低い組織は自律的なエンドツーエンドチームに必要なエンジニアリング能力とプロダクト開発の能力を身につけるのに時間が必要
- このとき，開発，運用，セキュリティなど専門性の高いチームが密接に協力して待ち時間を最小にして問題に素早く対処できるのであれば，許容範囲のトレードオフになる
- 中規模の組織やソフトウェアでは，スピードのためにチーム間での密接なコラボレーションを重視するパターンがうまく機能する
- 組織やソフトウェアの規模が大きくなるにつれて，下位のインフラストラクチャーやプラットフォームをサービスとして提供することに重点を置くことでユーザー向けのサービスの信頼性が向上し，顧客の期待に答えられることができるようになるという点でメリットがある
- 組織のエンジニアリングの成熟度と規律が高い場合には，これまでに説明した SRE モデルが大規模でもうまく機能する

### 責任の分割によるサイロの解消

- 仕事が多くなったときに単にチームを複製したり，人を追加したりするのではなく，より多くのメリットを定受するにはどの依存関係を取り除くべきか，どの依存関係は明示的に受け入れるかを考えることが重要

### チーム間の依存関係と待ち時間

- 責任が明瞭で独立して作業可能で，フローに最適化したチームにするにはチーム間の依存関係と待ち時間の検出と追跡が不可欠
- チームをまたぐ重要な情報を見える化することはチーム間のコミュニケーションに役立つ
- 依存関係がうまく機能するのに必要なコミュニケーションを推測すること
- 依存関係には知識，タスク，リソースという 3 つのカテゴリがある
- 領域ごとの依存関係を追跡し，特定の状況において意味のある基準を決めて警告を出すことが重要
- チェックもしないまま，依存関係の数を増加させるべきではない

  - むしろ，増加があった場合にチーム設計や依存関係の調整を始める

- Spotify ではスプレッドシートで簡単に見ている
  - そんだけ依存関係の検出，追跡は重要

## DevOps トポロジーを活用して組織を進化させる
