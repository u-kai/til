# チームファーストな境界を決める

## ソフトウェアの責任と境界に対するチームファーストのアプローチ

- ソフトウェアのデリバリーにおける多くの問題は，チーム間の境界とチームごとの責任が誤って不明瞭になったことに起因する
- この問題はパーツ間の結合度が高いソフトウェアとなって現れることが多く，モノリスと呼ばれている
- 密結合のアーキテクチャーが責任が明確で自律的なチームを持つ上で悪影響を与えることを実証している
- そのようなアーキテクチャを分離するのに役立つアーキテクチャ的なアプローチについて，目指すべきは，チーム間のコミュニケーションをさほど要せずに設計からデプロイまでの作業を完遂できる能力を促進するアーキテクチャを生み出すこと
- この戦略を可能にするアーキテクチャ面でのアプローチとしては，コンテキスト境界と API により，大規模なドメインをより小規模，より疎結合なユニットに分割する
- ただし，チームのことを考慮に入れないで進めると，モノリスを間違った形で分解したり，サービス同士の依存性が高い複雑なシステムを作り出したりするリスクがある
- これは分散モノリスと呼ばれ，すべての変更で他のサービスの更新が必要となり，サービスの自立性を欠く

## 隠れモノリスと結合

### アプリケーションモノリス

- 多くの依存関係や責任を持つ単一かつ巨大なアプリケーションで多くのサービスや様々なユーザージャーニを外部に公開しているもの
- このようなアプリケーションは単一のものとしてリリースされるのが普通で，ユーザーはデプロイの間，アプリケーションを使えない
- 運用担当者は本環境が安定せず，予定せぬ問題に悩まされる

### データベース結合モノリス

### モノリシックビルド(全てをリビルド)

- コードベース全体をビルドするようなビルドスクリプトになっているような場合

### モノリシックリリース

- コンポーネントやサービスは CI で独立してビルド可能でも，サービスのモックは使わず共有の固定環境でしかテストできない場合，前コンポーネントの最新バージョンをまとめて同一の環境に導入することになる
- コンポーネント一式を一塊としてデプロイすることでテストしたものが本番環境でも実行されるという確証を得たいため
- このアプローチは別のコンポーネントのテストを担当する独立した QA チームの存在によることもある
  - QA チームのキャパシティが限られていて複数のサービスの変更をまとめて行うことが理にかなっていると考えるため

### モノリシックモデル

- 一貫性重視には理にかなっているが，ドメインの対象領域が広いと難しい

### モノリシック思考(標準化)

- チームに標準化を矯正することで学習や実験がヘリ，その結果貧弱なソリューションの選択につながるという研究結果に言及している

### モノリシックワークスペース

- 実はオープンプランオフィスはコラボレーションを促進することはなく，電子的なやり取りが逆に増えてしまうらしい
- 必要なのは，いる場所を同じにするのではなく，目的を同じにすること
- 経験上，それを誤解しているとこのような問題が起こる

### ソフトウェアの境界

- ソフトウェアを複数チーム間で分割する場合にも注意しなければいけない危険なポイントがある
- ソフトウェアを分割すると，分割後のパーツ間で一貫性がヘリ，複数のサブシステム館で誤ってデータの重複を起こす可能性がある
- ソフトウェアの適切なつなぎめを見つけることが大事
- 通常はビジネスドメインの違いとソフトウェアの境界を合わせるのが最善
  - モノリスは技術的な観点で見ても問題が多い
- ビジネスドメイン以外にもソフトウェアでは複数のつなぎめの候補がある

### ビジネスドメインのコンテキスト境界

- 教会づけられたコンテキストを特定するには，多くのビジネス知識と技術的な専門知識が必要
- そのため最初は間違いやすく，コンテキストを深く理解できるようになったら，改善や適応に躊躇してはいけない
- これはサービス再設計のコストが繰り返しかかってくるような状況であっても

### 地理的分散について

- チームが効率的にコミュニケーションするためのオプションは 2 つ
- 1 つはチームメンバー全員が同じ物理スペースを共有する形で同じ場所にいること
- もう一つは完全なリモートファーストのアプローチ
  - チーム全員がいつでもアクセス可能なメッセージングツールやコラボレーションツールなど合意したチャネルでのコミュニケーションを明示的に矯正する
- 上記のどちらも実現できない場合は，モノリスを別々のロケーションのチーム用のサブシステムに分割するのが良い
- こうすることで，システムアーキテクチャを現実のコミュニケーションの制約に合わせることができる

### つなぎめのリスク

- 明確に異なるリスクプロファイルを持つサブシステムに分割することでビジネス的な思惑や規律上のニーズに合わせて技術的な変更を行えるようにする

### パフォーマンスによる分離

### 技術

- 技術手動で分割すると全体的な視点ではそれぞれのチームの作業の透明性は低くなり，チーム内のコミュニケーションと比べてチーム間のコミュケーションは遅くなる
- その上，プロダクトの依存関係が残り続けるためチームの自立性が低くなる

### ユーザーペルソナ

### 特定の組織や技術にとって自然な繋ぎ目

- うまくいっているかどうかは，結果として得られるアーキテクチャが多くの自律的チームの支えとなって認知負荷が減るかどうかを確認する
- システムとチームの境界を評価するのに役立つ簡単な方法は単純にチームはこのサブシステムをサービスとして効果的に利用したり提供したりすることができるのか？と聞いてみること
  - 答えがイエスなら，そのサブシステムは分割してチームに割り当てて，進化させていくのにふさわしい候補となる
