# オブザーバビリティ駆動開発

- TDD が特に強力なのはテストが毎回同じ方法で実行されること
- テストの役割は制御された状態からの予期せぬ逸脱を特定し、エンジニアが即座に対処できるようにするもの
- しかし、一貫性と分離性によって TDD が実稼働中のソフトウェアで何が起こっているのかを明らかにできるわけではない
- 本番環境は一貫性がないことが多い
- TDD の移管性と分離はコードを扱いやすくするが、その一方で表面化し、モニタリングし、ストレスを与え、テストすべき興味深い以上に対して準備することはできない
- なぜなら、そのような以上は実際に人がソフトウェアを操作した時、最終的なソフトウェアの挙動として形成されるから

- オブザーバビリティはより良いコードを下記、リリースするのに役にたつ
- なぜならそれはエンジニアがコードのバグをより素早く発見するためのツール、プロセス、文化の一部だから

## 開発サイクルにおけるオブザーバビリティ

- バグを迅速に解決するには原作者の頭の中に新鮮な石が残っているうちに問題を検証できる稼働かに強く依存している
- オブザーバビリティとより良いソフトウェアを書くこととの関連性は素早くデバッグしたいというニーズ

## デバッグする場所を特定する

- オブザーバビリティの新参者はオブザーバビリティがコードをデバッグするための方法だったり、非常に詳細なログ管理であると考えるような間違いを犯す
- デバッグは可能だが、目的ではない
- オブザーバビリティはコードのロジックをデバッグするものではなく、デバッグが必要なコードがシステムのどこにあるかを見つけ出すためにある
- コードの行数に対して行ってしまうと、ログなどに対して壮大な料金がかかってしまう
- バグの発生場所と発生方法の性質がわかればオブザーバビリティの仕事は終わり
- そこからコードそのものを深く折下げたければ昔ながらのデバッガーを使うこと
- オブザーバビリティのおかげで、そのリクエストなどを簡単に再現することができる

## マイクロサービス時代のデバッグ

## 計装でオブザーバビリティを駆動する

- 良い軽装はおブザーばビリティを駆動する
- 計装がどのように役立つのかを考える一つの方法は、プルリクエストの状況で考慮すること
- プルリクエストをサブミットしたり、アクセプトする前に、この変更が意図した通りに動いているかどうか、私はどうやって確認できるだろうか？と自分自身に問いかける必要がある
- リリースされるコードをマージした担当者を自動的にオンコールのページングにすること
- エンジニアが本番環境で自分のコードが起こした問題を体験するとしたら問題の切り分けや解決を迅速に行うためコードに計装を加える能力が自然に高まる
- エラーのフィードバックから遮断されると、高品質のコードをリリースす流ために必要な直感やプラクティスを身につけられない
- 全てのエンジニアはデプロイ後すぐにこれらの質問に答えられるように自分のコードに計装することを期待されるべき

  - コードは意図的に動くか
  - 前のバージョンと比較してどうか
  - ユーザーはコードを使えているか
  - 異常事態は発生していないか

- 機能フラグなどを利用して、迅速なフィードバックループを得ることもできる

## オブザーバビリティをシフトレフトする

- TDD は開発したソフトウェアが隔離された使用に準拠することを保証する一方で、オブザーバビリティ駆動開発は本番環境という厄介な現実の中でソフトウェアが機能することを保証するもの
- 開発ライフサイクルの早い段階でソフトウェアに計装することで、小さな変更が本番環境に与える影響を敏速に検討しつつ、迅速に確認できるようになる
- 隔離された使用の順守飲みに焦点を当ててしまうと、チームは不用意に可視性を阻止するような状況を作り出してしまい、ソフトウェアは厄介で予測不可能な人々の問題に直面し、カオスな遊び場と化す
- 本番環境について正確に推論できないためチームはしばしば本番環境をガラスの城のような物にとらえてしまう

  - 不足の事態が発生すると構造物全体が破壊される可能性があり、それを恐れてしまう

- 優れたテレメトリーとオブザーバビリティを備えたコードを書き、デプロイし、活用するエンジニアリングスキルを身につけることでチームは本番環境で実際に何が起こっているのかを推論する能力を身につけることができる
- オブザーバビリティ駆動開発によって、ガラスの城をインタラクティブな遊び場に変身させられる
- 本番環境は普遍のものではなく、アクションに満ちた物になり、エンジニアはどんなゲームにも自信を持ってのぞみ勝利を収められるようになる

## おブザーばビリティを活用してソフトウェアデリバリーを高速化する

- エンジニアリングチームの健全性と有効性はコードが書かれてから本番環境に出るまでの時間という単一のメトリクスが最もよく把握できる
- 全てのチームはこのメトリクスを追跡し、その改善に取り組むべき
- オブザーバビリティ駆動開発を機能フラグや斬新的デリバリーパターンと併用することでエンジニアリングチームは新機能のリリース中に問題が発生した場合は、直感的にデプロイをロールバックするのではなく、何が本当に起こっているのかをさらに深く調査するためのツールを手に入れられる
- しかし、それはチームが速いペースで本番環境にコードをリリースできるかどうかにかかっている
  - もしチームが現在そうできていないのであれば、コードの本番環境へのデリバリーを高速化するための方法が以下
    - コードのまとまった変更を一度に 1 つずつ、一人のエンジニアが 1 回マージしてリリースする
      - デプロイで何かが壊れ、その原因を突き止めロールバックするのに何時間も何日もかかるのは多くの変更を多くの人が何日もかけて一括で行っていることが最大の原因
    - デプロイプロセスとコードに、真のエンジニアリングの労力を費やす
      - インターンではなく、経験豊富なエンジニアに担当させる
      - 全員がデプロイパイプラインを理解し、継続的に改善する権限があると感じられるようにする

## まとめ

- テスト駆動開発は定義された使用に対してコードがどのように実行されるかを検証するのに有用なツール
- オブザーバビリティ駆動開発は本番環境でのコードの振る舞いを検証するための有用なツール
