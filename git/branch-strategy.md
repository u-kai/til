# ブランチ戦略

## ブランチを分けるのか分けないのか？

- ブランチを分けて安全に本番ブランチ(以降では main)に分けるものとブランチを分けずに迅速に本番ブランチにプッシュするものがある

- ブランチを分けて行う方法(何かのツールではなく方法)はいくつか主流のものがある

  - git-flow
  - GitHub Flow
  - gitworkflows
  - GitLab Flow
  - 参考:https://qiita.com/trsn_si/items/cfecbf7dff20c64628ea

- Qiita とか Zenn とか社内事例を見る感じ ブランチを分けるやり方が多い印象

  - アジャイルや設計思想の書籍によく書かれていることは，OSS のような不特定多数の人に Contribute してもらうようなプロジェクトや，プロジェクトに多くの工数を当てられない場合は選択するもの

- CI の思想では 1 日 1 回は main に統合する必要があるのでブランチを分けない方が良いとされている
  - アジャイルや設計思想の書籍に書かれていることは滅多なことがない限りブランチは分けない方が良いとされている

## それぞれのメリットデメリット

### ブランチを分ける

- メリット

  - 本番環境への影響を抑えることができる
  - 徹底的にレビューやテストをした結果統合できる
    - ただし仕組みをつくればブランチを分けないやり方でも可能
  - GitHub などのリモートレポジトリへのブランチ統合やレビューなどの機能が豊富
    - 権限がある人のみを main ブランチの統合を可能にし，変更前レビューを強制させるなどが有名

- デメリット
  - 長命なブランチができやすい
  - 長命なブランチと統合する際はレビュー範囲や，Conflict，統合による影響が大きくなる可能性が高い
  - 開発速度(このケースだと統合までの時間が係数として大きい)がレビュワーの忙しさに依存するようになる

### ブランチを分けない

- メリット

  - すぐに本番環境へ変更を加えることができるため，小さくて頻繁な変更がしやすい
    - 小さい変更は変更の統合が簡単
    - 小さい変更はエラーが起きにくい
    - 小さい変更は何かのエラーが起きてもすぐに修正できる
    - 小さい変更はレビューが簡単

- デメリット
  - レビューや main への統合前のテストを矯正させたければそのような仕組みが必要
  - main に統合するのですぐに切り戻せるような仕組みも必要
  - main に統合するので，多くの自動テストが走ることになるが，それを変更範囲に止めるような工夫が必要

## 考察

- どちらも仕組み次第では良いところを補える気がする
-
