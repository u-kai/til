---
marp: true
---

# IAM について

---

# この資料について

- AWS を利用する上で不可欠な IAM について概要を抑えることを目的としたもの
- IAMxxx について各リソースの違いがわかるようになる

---

# 目次

- IAM とは?認証認可とは？
- IAM の必要性
- IAM Policy について
- IAM User について
- IAM Role について
- IAM Role と User の違いについて

---

# IAM とは？

- AWS Identity and Access Manager の略
- AWS を利用する上での ID 管理，認証，認可のサービス
- ちなみに IAM という言葉自体は AWS 以外の文脈でもよく使われる

  - GCP のドキュメントから

    > > 誰(ID)がどのリソースに対してどのようなアクセス権(ロール)を持つかを定義することにより，アクセス権限を管理します.

以降では単に IAM と記載した場合は AWS IAM を指します

---

# ID？認証？認可？

- 言葉の意味から一つずつ説明します

---

# ID とは

- 文脈(コンテキスト)によって意味が変わるが，前ページの文脈だと
  **何かを指すための一意性のあるもの**
- 例

  - 会社コンテキスト
    - 社員 ID
  - 知人コンテキスト
    - 呼び名
  - IAM コンテキスト
    - AWSAccessKeyId

---

# 認証とは

- 何であるかを確認すること
- 認証の多くの方法が ID とパスワードなどの秘密情報の対を示すことによって確認する
- IAM の場合は以下の通り
  - ID
    - AWSAccessKeyId
  - 秘密情報
    - AWSSecretAccessKey

**認証が成功すると，ID で示されている本人であると認識される**

---

# 認可とは

- 権限を与えること
- 権限とはできること，できないこと
- 権限の例

  - ファイルの読み取りはできるけど，書き込みはできない

- AWS だと IAM Policy に権限を記述する

**認可が成功すると，与えられた権限のことをすることができる**

---

# 一旦整理

- ID

  - 何かを示す一意の値
  - IAM だと AWSAccessKeyId

- 認証

  - ID や秘密情報を使って，その ID 本人であることを確認すること
  - IAM だと AWSAccessKeyId と AWSSecretAccessKey

- 認可
  - 権限(できること／できないこと)を与えること

---

# IAM の必要性

---

# IAM の利用用途

## ほとんどの AWS サービスの API 呼び出しには，IAM をつかった認証認可が行われている

つまり AWS サービスの API を呼び出したい時には IAM が必要

もし IAM この世に存在しなければ AWS サービスの API 呼び出しに対して独自で認証認可の仕組みを構築するか，だれでも API を呼び出せて良いようになる

---

# IAM がない世界線

前ページのように IAM がないと自前で認証認可の仕組みを作成するか，だれでも API を呼び出せる状態を許容するかになる

例えば S3 を使ったシステムを考えてみる

IAM がないと

- S3 のデータを誰でも閲覧できてしまいます
- S3 のデータを改竄されてしまいます
- S3 にマルウェアなどのウィルスをばら撒かれてしまいます

## こんなこと許容できるわけがないですよね？

---

# IAM がやってくれていること

AWS リソースの API を呼び出す際に，認証認可を行っている

## つまり，作成した AWS リソースを誰がどのように利用できるかを制御できる

---

# さっきの例だと

S3 へのアクセスはあるユーザーのみに限定するような IAM の設定をすると...

- S3 のデータは誰でも閲覧できなくなります
- 悪意のある第三者は S3 のデータを改竄できなくなります
- 悪意のある第三者は S3 にマルウェアなどのウィルスをばら撒けなくなります

# 安心安全！あるべき姿!

IAM の必要性がわかったところで次からは具体的な IAM の構成要素を紹介

---

# IAM Policy

---

# IAM Policy とは

## 簡単にいうと権限の羅列

```json
{
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    },
    {
      "Effect": "Deny",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    }
  ]
}
```

---

# IAM Policy の利用用途

- IAM Policy は 権限の羅列でしかなく,それが誰(何)に対しての権限なのかの情報はない
- つまり IAM Policy だけでは意味がなく，誰(何)に対しての権限なのかを明示する必要がある
- 具体的には，IAM User や IAM Role, IAM Group に対して IAM Policy をアタッチすることで，誰(何)に対しての権限なのかを明示できる
- ここで誰(何)に当たるのが IAM User や IAM Role, IAM Group の役目

### IAM Policy は権限の羅列で,IAM User などにアタッチして権限を与えるもの！

---

---

# Column：認証と認可の関係

- ほとんどのサービスが認証後に認可を行う
  - IAM もそのような流れ
- ただし，必ずしも認証と認可はセットでなくても良い
- 例
  - 電車の切符
    - 切符を買う際に認証は不要だが，認可(電車に乗る権限)は付与される

---

# Column：認証と認可を分ける理由

**Q: ほとんどのサービスが認証後に認可するならば認証と認可は一緒でいいのでは？**

- 認可で与えられる権限は動的に変わりやすい
  - 部署移動したら権限は変わるはず
  - イけているシステムは,ユーザーがいつもと違うところからアクセスしていたら認可する権限を弱めてセキュアにすることも
- 認証に利用するデータは静的な性質がある
  - 部署移動してもあなたはあなた
  - どこからアクセスしても，怪しくても，認証突破後はあなたはあなた

**A:性質が異なるものを，分けることで，管理性とセキュリティを向上**
