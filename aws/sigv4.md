# AWS API リクエストの署名

- API リクエストには誰がそれを送信したのかわかるように署名がされる
- 署名バージョン 4 は AWS 署名プロトコル
- リプレイ攻撃を防止するために，リクエストのタイムスタンプの 5 分以内に AWS に到達する必要がある

## API リクエスト署名の要素

- 以下の要素を含める必要がある
  - エンドポイント仕様
  - アクション
  - アクションパラメータ
  - 日付
  - 認証情報

## エンドポイント仕様

- リクエストの送信先となるエンドポイントの DNS 名を指定する
- この名前には通常，サービスコードとリージョンが含まれる

  - us-east-1 の dynamodb のエンドポイントにアクセスする場合は dynamodb.us-east-1.amazonaws.com となる

- HTTP/1.1 リクエストには Host ヘッダーを含める必要がある
- HTTP/2 リクエストには :authority ヘッダーまたは Host ヘッダーを含める必要がある

## アクション

- サービスの API アクションを指定
- dynamodb の CreateTable アクションなど

## アクションパラメータ

- リクエストで指定されたアクションのパラメータを指定する
  - API バージョンは通常必須パラメータ

## 日付

- タイムスタンプは UTC で ISO8601 形式を使用する必要がある
  - 20220830T123600Z のようなもの
- date または x-amz-date ヘッダーを使用するか，x-amz-date をクエリパラメータとして含めることができる

## 認証情報

- 送信する各リクエストには次の情報を含める必要がある
  - アルゴリズム - HMAC-SHA256 のアルゴリズムで Signature Version 4 を指定する場合に AWS4-HMAC-SHA256 を使用する
- 認証情報

  - アクセスキー ID，YYYYMMDD 形式の日付，リージョンコード，サービスコード，およびスラッシュで区切った aws4_request 終端文字列からなる文字列

  ```
  AKIAIOSFODNN7EXAMPLE/YYYYMMDD/region/service/aws4_request
  ```

- 署名付きヘッダー
  - 署名に含める HTTP ヘッダーをセミコロンで区切る
- 署名
  - 計算された署名を表す 16 進エンコードされた文字列
