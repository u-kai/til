---
marp: true
---

# Copilot に関するレポート

---

はじめに

- 本レポートは個人的主観に基づいているものが多いです
  - Copilot が新しい技術かつ AI を用いたプログラミングのベストプラクティスはまだはっきり確立されていないためご了承ください(言い訳)
- 本レポートで紹介すること以外にも Copilot の有用性などは様々な意見があるかもしれません

---

# 目次

- 本レポートの目的
- Copilot とは?
- Copilot の機能や使い方
- Copilot の有用性
- Copilot に対する懸念
- まとめ

---

# 本レポートの目的

- GitHub Copilot とは何か，どのような特性があり，どのような時に，どのくらい有用なのか，利用する上で企業での課題は何かなどを共有する
- Copilot を全社的に利用していくにはどのように課題を克服して，どのように広めていけばいいのかを皆様にも案を出していただく第一歩にする

---

# Copilot とは？

---

# Copilot 概要

- 正式名称は GitHub Copilot
- 2021/7 月からプレビューとして公開され，2023/2/15 から Copilot Business が GA
- 現在の利用形態は個人利用と，企業利用の 2 種類
- 学習データは GitHub 上のパブリックコード

  - 数億行!(Amazing!)

> GitHub Copilot は AI ペア プログラマーです。 GitHub Copilot を使うと、エディター内で行全体または関数全体の候補を得ることができます。
> https://docs.github.com/ja/copilot/quickstart

## コードを書くときに AI がコードを提案(サジェスト)してくれる!!

---

# Copilot の機能や使い方

---

# Copilot を使う上での 前提条件

- Copilot は IDE(JetBrains や VsCode,NeoVim 等)が開発者とのインターフェイス
  - API は明示的に公開されていない
- 上記 IDE に Copilot の機能をインストールして利用する

---

# Copilot 機能 - コードのサジェスト -

### コードを少し記述するとその文脈でサジェストしてくれる

![height:400](suggest.png)

## ちゃんとした最適なアルゴリズム!!

---

# Copilot 機能 - Q & A -

### Q & A できちゃう！

![](q-and-stackoverflow-a.png)
ちゃんと正常な URL(1) でした

![](q-and-tdd-a.png)
だそうです

---

# Copilot 機能 - 複数サジェスト -

### Ctl+Enter で 10 候補ほどサジェストしてくれる!

![width:1000](many-suggest.png)

---

# Copilot 機能 - 複数サジェスト -

### 選択したサジェスト上の Accept Solution ボタンを押すとコードに反映してくれる

![](after-suggest.png)

---

# Copilot その他の機能

- 以下のようなソリューションが GitHub Copilot Labs という形で実験的に提供/実装されていっている
  - 選択した部分のコードレビュー
  - 選択した部分のコメントを生成
  - 選択した部分の テストコードを作成
  - 選択した部分の他プログラミング言語への変換
  - などなど

今後がますます楽しみ...

---

# Copilot の有用性

---

# 有用性について(GitHub 社調べ)

![](copilot-numbers.png)
※ https://github.com/features/copilot/

---

# 有用性について(個人的な所感)

- ### 相当良い！最高!
- ### テストやコメント，型定義など，今までめんどくさかったコードをサジェストしてくれるので，書くのが楽しいし，速度がましているのにコード品質も向上されている!

## Copilot なしではプログラム書きたくないほどに有用!!!

![width:1000](comment-suggest.png)

むむむ．．．わかってるやん

---

# 各機能の有用性について

前のページのように，Copilot にはコードのサジェスト以外にも Q&A や複数サジェストの機能がある

### ただしコードのサジェスト以外はあまり有用ではない印象

- Q&A と複数サジェストを Copilot で行うぐらいなら ChatGPT の方が有用と感じる

---

# Copilot の有用な利用シーン(個人的所感)1

## システム開発

- ある程度規模が大きいものを作成する場合は Copilot が文脈をどんどん読み取っていくので良いサジェストが来る印象
- 良い設計であるほど GitHub に存在するパブリックコードと同じような質になるので，良いサジェストを得られやすい印象
- 一般的なアルゴリズムなど，単純なものであればすぐにサジェストしてくれるため，システム特有のコードの設計に時間を割けられるようになる

---

# Copilot の有用な利用シーン(個人的所感)2

## テストコード

- 既存コードのテスト
  - 元のコードがあるのでその文脈でテストを作成してくれる
  - テストの命名やテストメッセージの作成などをすぐに作成してくれる
- TDD

  - テストから書くことで，実装するコードの文脈が明確になるので，Copilot が有用

- 繰り返し書くようなメッセージやテストデータを精度良く作成してくれるのでテストを作成するのが快適になる

---

# Copilot の有用な利用シーン(個人的所感)3

## コメント文

- コメント文もコードの文脈から書いてくれる
- コメント文を書くのが快適になるので，コメントを書きたくなってくる

---

# Copilot の有用な利用シーン(個人的所感)4

## 静的型付け言語による開発

- サジェストはコードの正しさではなく，コードの文脈で行われる
  - そのため，間違っているコードをサジェストすることは少なくない
- そこを静的型付けによって補うことで，間違ったサジェストを型レベルで防ぐことができる
- また，静的型付けのデメリットに型の定義を書くコストが高いと言ったものがあるが，Copilot のサジェストによってそのコストが大幅に下がる

---

# Copilot の有用性(まとめ)

- テストやコメントなど，今までめんどくさかったところがコスト低く作成できるので，テスト，コメントを作成したくなる

  - テストやコメントを作成することで，コードの品質が向上する

- 静的型付けと組み合わせると，Copilot のミスを型レベルで発見することができる

### 既に書く内容が決まっているものに対して効果抜群な印象

---

# 適さないケース(個人的所感)

- 教育

  - 甘えてしまうようになる

- その場限りの簡単なコード

  - 適さないとまで言わないが，ChatGPT と対話的に行う方が有用なイメージ
  - サジェストに任せっきりにすると，ミスが多くなり，逆に時間がかかる

- 書くべきことがわかっていない場合
  - 適さないとまで言わないが，ChatGPT と対話的に行う方が有用なイメージ
  - 書くことがわかっていないので Copilot もサジェストのしようがない
  - サジェストされたコードの確らしさを開発者が判断できない

## Copilot はあくまで Copilot(副操縦士)の印象

---

# Copilot の有用性における考察まとめ

- 書きたいコードがわかっている時に，Copilot は効果を発揮する印象
- Copilot はコードの文脈を読み取るのが上手いので，コードを書けば書くほど Copilot が人間の意思を汲み取ってくれる印象
- 人間が書くコードが設計を意識した綺麗なものであるほど良いサジェストが来る印象
- コードを書く時間が減るので，設計やテスト,コードレビューに多くの時間を割くようにすれば，速度だけでなく，品質も向上すると考えられる.
- 書きたいコードがわかっていない時にコメント文による指示や Q&A での質問はあまり精度が良くない印象
- 書きたいコードがわからない時は，まず設計するか，ChatGPT と対話的にコードを書くのが良いと感じる
  - 0 -> 1 　は ChatGPT ,1 -> 10 は Copilot という感じ

---

# Copilot に対する懸念

---

# コードの学習や Copilot に送信されるデータについて

- Copilot は GitHub のパブリックコードを学習している
- Copilot を利用することで自分たちのコードが学習されることはない
  - コードは Copilot へ送信されるが，それはサジェストを作成するための一時的なデータとして扱われるだけ
- GitHub のアカウント Id やサジェストを受け入れたか，拒否したかなどのデータは送信され，今後のサービス向上に利用される

## ここは問題なし！

---

# コードのバグや脆弱性について

- サジェストされたコードにバグや脆弱性がないとは言い切れない
  - むしろ動かないコードをサジェストしてくることは多い
- これはコードレビューやテスト，静的型付けなどでカバー可能

## そもそもコードを書くのが早くなるので，その分,人間は品質を向上することに努めるようにすることが重要

## プログラミングに関する知見が一層重要になる

---

# コードのライセンス違反について

- GitHub のパブリックコードをそのままサジェストする可能性があるため, 厳密なライセンスが付与されているコードがサジェストされることがある
  - コードレビューなど対策しても完全に防ぐことは難しい

## 知らず知らずのうちにライセンス違反をしてしまう可能性がある!

## これが相当問題.企業で利用する場合に壁となるところ

上記を対策するための機能が提供されているため次ページから説明

---

# ライセンス違反対策機能

## パブリックコードのサジェスト禁止機能について

Copilot の設定で Suggest matching public code を Block に設定可能

Copilot がサジェスト予定のコードの 150 文字以上のコードがパブリックコードと一致する場合にサジェストをブロックする機能

要は，パブリックコードをそのままサジェスト(丸パクリ)することを防止する機能

### これによってライセンス違反を防ぐことができる？？

---

# 案外そうでもない

1. 丸パクリせずとも，コードが似ていればライセンス違反になる可能性は十分にある
   https://githubcopilotinvestigation.com/

2. この機能を ON にしても丸パクリしている疑惑が検証によって発覚
   次のページで説明

---

# リファクタリング本をそのままサジェストしてきた！

![width:800](refactoring-suggest.png)

---

# ここでの問題と新たな問題

## 問題

- リファクタリング本は著作権で保護されているため，そのままサジェストされた結果を商用で利用するとアウト
- ### そもそもパブリックコードはブロックするんじゃなかったけ？

## 新たな問題

- 著作権で保護されているコードがサジェストされるということは, GitHub 上には著作権やライセンスを無視して利用しているコードがたくさんある可能性が高い

### ライセンスをもつコードをサジェストされたことによる違反や,そもそも違反をしているコードをサジェストされることによって違反をする可能性が出てくる

---

# ライセンス違反を予防する今後の機能

![width:1000](feature.png)
本機能でライセンス違反を防ぐことができる可能性が高い!
https://github.blog/2022-11-01-preview-referencing-public-code-in-github-copilot/

---

# 現在の MS の主張

![width:10000](responsible-copilot.png)

## Copilot がサジェストしたコードはあなたのコードです※

※ 責任持てよという意味

## https://github.com/customer-terms/github-copilot-product-specific-terms

---

# ライセンス違反に関する個人的意見 1

## そもそもライセンス違反となりうるコードがサジェストされる可能性は低いのでは？

前ページの例は無理やりサジェストさせたものであるし，本のコードという，システム開発では一切採用しないもの

またサジェストされるコードが自分が書きそうなコードであればライセンス違反する可能性は低いのでは？

---

# ライセンス違反に関する個人的意見 2

## コードレビューをしなかったり，サジェストされたコードの説明ができないようなサジェストを積極的に採用することは危険

逆にコードレビューを必須にして，自分たちのコードにしていけばリスクを極小化できると考えている

---

# ライセンス違反に関する個人的意見 3

## 開発するシステムのスコープもリスクに関係してくるのでは？

社内用/社外用/製品か,でライセンス違反による提訴のリスクが変わるのではないか？

---

# Copilot 利用に関する個人的意見

- Copilot を利用してコードを作成することは速度だけでなく品質向上や開発体験の向上に大きく寄与するので積極的に利用していきたい
- 可能性の低いライセンス違反を気にするよりもリテラシーの高い部門にはどんどん利用させたい!
  - 料金は安くないので，リテラシーがある人しか使わない説もある?
- ただし，部門にどのようにアナウンスすればいいのか，ライセンス違反に関するリスクをさらに極小化できないのかは検討が必要
- 今後さらに AI の発展が予想されるので，AI を利用できるような高度な知識を持つ技術者の育成が必要になってくるのではないか？

---

# まとめ

- Copilot の機能や有用性，危険性などを共有した
- Copilot の利用は速度だけでなく品質向上や開発体験の向上に大きく寄与する
  - ただしその恩恵を受けるためにはそれなりの知識が必要
- ライセンスを無視したコードがサジェストされる可能性がある
- 問題はあるものの，うまくリスクを極小化して積極的に利用していくべしという意見

---

---

# 補填

---

# 参考

(1)https://stackoverflow.com/questions/5811151/why-do-we-check-up-to-the-square-root-of-a-number-to-determine-if-the-number-is

- https://github.com/features/copilot/
- https://zenn.dev/miyajan/scraps/3567cee380280c

---

# Copilot の動作原理

- OpenAI の Codex というモデルがバックエンドで推論，サジェストをしてくれる
- Copilot は VSCode などの IDE をインターフェイスとして動作する

![width:700](copilot-arch.png)

---

# 利用形態について

### 1. Copilot for Individuals(10$ / month \* user)

### 2. Copilot Business(19$ / month \* user)

- 弊社は GitHub Enterprise を利用しているため Business での利用が可能
- Business の利点

  - Individual の機能全てを保有
  - Enterprise 全体への統一した policy 設定が可能
  - 自己証明書を利用する Proxy 設定が可能(Zscaler!!!)
  - Business の利用者は Enterprise 外の個人開発にも Copilot を利用可能

- 弊社環境では統一した policy 設定と Proxy の設定が可能な Business がベスト

---
