# パッケージ

- Go では全てのソースコードがパッケージに属する
- フォルダ＝パッケージ
- ソースコードの先頭は必ず package 文
- フォルダに含まれるファイルは論理的な階層とはならない
- フォルダ内に含まれるファイルは基本的に全て同じパッケージ名でないといけない
- 例外としてテスト専用の$package_test だけは共存可能
- 慣習としてパッケージ名とフォルダ名とを同一にすることが多いが，変えることもある
- Go で書かれるアプリケーションのエントリーポイント func main は必ず main パッケージに含まれている必要がある
- この場合のフォルダ名はアプリケーションの実行ファイル名と同一にする

## 最低限のパッケージ構成

- Go のパッケージングにおける最低限のルールは次の 2 つ

  - 同一フォルダ内のファイルは同一パッケージとなる
  - 実行ファイルのエントリーポイントは main パッケージとなる

- 実行ファイルを含むモジュールの場合，最上位フォルダに cmd フォルダを作り，その下でコマンド名と同一のフォルダ名を作って，そこにコードを置く
- この cmd フォルダを作成して，その下に各コマンドのパッケージを置く方法は広く使われている
- cmd 以下に置くコードはなるべく減らし，ルートのパッケージに持ってくるようにする

## プライベートリポジトリのモジュールを参照する方法

- 社内ように開発しているリポジトリなど，プライベートなリポジトリで開発しているモジュールを参照したい場合がある

- Go Modules では go.mod に記述された依存関係を解決するために環境変数 GOPROXY に記述されたパスにリクエストを試みる
- まずhttps://proxy.golang.orgにリクエストし，失敗したらdirectの挙動，つまり，go.modに記述されたパスに直接リクエストする
- プライベートリポジトリにあるモジュールはhttps://proxy.golang.orgやhttps://sum.golang.org/などのチェックサムデータベースには登録されないため，Goが提供するプロキシ経由ではモジュールを取得できない
- また go.mod に記述されたモジュールのチェックサムを確認するための環境変数 GOSUMDB に記述されたパスにアクセスする
- sum.golang.org のチェックサムデータベースにもプライベートリポジトリにあるモジュールは登録されていないので，チェックしないように GOSUMDB=off とする必要がある
- GOSUMDB を off にする代わりに，環境変数 GOPRIVATE を用いて go のコマンドにプライベートなモジュールだと認識させる方法がある
- GitHub のプライベートリポジトリに直接アクセスしてモジュールをダウンロードする場合，git config で GitHub のアクセストークンを設定しておく必要がある

```
git config --global url."https://${access_token}:x-oauth-basic@github.com/repo_name".
insteadOf "https://github.com/repo_name"

```
