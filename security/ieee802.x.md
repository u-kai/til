# IEEE802.1X

- 認証に成功した端末だけが特定の VLAN に接続できるようにする技術
- 認証の成否に応じて VLAN を切り替えてくれる
  - この機能を持つスイッチを認証スイッチと呼ぶ
- 無線 LAN だと認証スイッチが AP

## 認証手順

- 端末が認証スイッチのポートに接続されると，認証サーバは端末を認証する

  - 同時に端末はサーバを認証する
  - この時点の VLAN は認証前 VLAN

- 認証に成功すると認証サーバは接続許可 VLAN の VLAN ID を認証スイッチに送信する
- 認証スイッチはポートが所属する VLAN を動的 h に接続許可 VLAN に切り替える

- ここで登場する認証サーバーが RADIUS サーバ
- 認証スイッチの役割として，端末と RADIUS の仲介と動的な VLAN の切り替え

  - ポート単位のアクセス制御を行なっている

- 認証スイッチのことをオーセンティケーた，端末をサプリカントという

## EAP による認証方式の指定

- IEEE802.1X の認証ではサーバ認証，クライアント認証の両方を行う
- 認証方式は様々あり，EAP を利用して認証方式が指定される
- 認証スイッチと認証サーバ間の EAP パケットは RADIUS でカプセル化されることが多い
  - このとき PC は RADIUS で認証されていることは気にしなくていいのかな？

### EAP-PEAP 認証

- サーバ認証に電子証明書を用いたクライアント認証にパスワードを用いるもの
- TLS でサーバ認証のみを実施し，TLS で生成，交換した共通鍵を使って暗号化通信を行いながら，チャレンジ／レスポンスでパスワード認証を実施する

### EAP-TLS 認証

- サーバ認証とクライアント認証の両方に電子証明書を用いるもの
- 認証サーバとクライアント間の双方に電子証明書をインポートし，電子証明書による相互認証を行う
- 電子証明書の管理が必要
- クライアント端末にインストールするべきものとしては

  - クライアント証明書
  - クライアント秘密鍵
  - サーバ証明書を発行した CA の自己証明書
    - RADIUS サーバの CA 機能とあるがそんな機能あるんや

- クライアント認証で認証しているのは端末のため，パスワード認証などの端末を認証するものが別途必要

## EAP-TLS 認証方式の認証シーケンス

- 無線 LAN 端末と AP 間でアソシエーションが確立される
  - しかし IEEE802.1X の機能により認証に成功しないと無線 LAN 端末は AP を経由してデータを転送することはできない
- 無線 LAN 端末と AP の間は EAPOL,AP と認証サーバ間は RADIUS で通信している

- 無線 LAN 端末と認証サーバ間が認証される
  - その間 AP は EAP パケットを中継しているだけ
- この認証を成功すると端末と AP の両者で PMK(Pairwise Master Key)を共有できる

  - PMK は暗号化通信の鍵の元となる情報

- まず認証サーバが AP に対して MPPE というプロトコルを用いて暗号化した PMK を送信する

  - AP が認証 VLAN をサポートしている場合は無線 LAN 端末が所属する VLAN ID を通知する

- 無線 LAN 端末から見ると AP は世紀の AP であるのかがわからない
- また AP からも暗号化された通信を中継するだけなので端末が認証されているのかがわからない
- そこで無線 LAN 端末と AP が同じ PMK を共有していることを検証することで，相互に主体認証を実行している
  - 不正な端末は認証されないし，不正な AP は PMK 転送がされないので
- PMK と乱数などによって端末と AP 間の通信で使用される共通鍵が生成される
- この共通鍵は暗号化鍵と認証鍵が別々であり，PTK(Pair Transient Key)という
  - AP にアソシエーションするたびに生成されることから，一時鍵(Temporal Key)とも呼ばれる
- さらに暗号鍵の生成時にマルチキャスト通信で使用される共通鍵が AP から配信される
  - この共通鍵は暗号化鍵と認証鍵が別々であり，GTK(Group Transient Key)という
  - この共通鍵は AP が定期的に生成する GMK(Group Master Key)と呼ばれる乱数などに基づいて生成される
    - GMK が変更されたとき，GTK も新たに生成される

## PMK キャッシュ

- 無線 LAN 端末と AP がそれぞれ PMK をキャッシュしておくこと
- 無線 LAN 端末は別の AP へローミングした後，元の AP のところへ再び戻ってくることがある
  - このとき PMK キャッシュをしておけば，アソシエーションの確立と暗号鍵の生成んみになり，802.1X 認証が不要となる
