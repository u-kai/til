1. コンピュータの電源を入れる
1. BIOS や UEFI などのファームウェアが起動してハードウェアを初期化する
1. ファームウェアが GRUB などのブートローダを起動する
1. ブートローダが OS カーネルを起動する
1. カーネルが init プロセスを起動する
1. init プロセスが子プロセスを起動してさらにその子プロセスを、続き、プロセスの木構造を作る

- この木構造は pstree コマンドを使えばプロセスの親子関係を気構造で示しくれる
  - -p オプションをつけて PID も表示するようにしておくとよい

# プロセスの終了

- プロセスを終了させるには exit_group()というシステムコールを呼び出す

  - exit()関数を呼ぶと内部でこの関数が呼ばれている
  - プログラム自身が呼ばないとしても libc などが内部的に呼び出している
  - exit_group()関数の中でカーネルはメモリなどのプロセスのリソースを回収する

- プロセスが終了した後は親プロセスが wait()や waitpid()といったシステムコールを呼び出すことで次のような情報を取得できる

  - プロセスの戻り値
    - exit()関数の引数を 256 で割ったあまりに等しい
    - exit の引数に 0~255 を指定した場合は引数の値がそのまま戻り値になる
  - シグナルによって終了したか否か
  - 終了までにどれだけの CPU 時間を使ったのか

- bash の中からであれば、バックグラウンド実行したプロセスを内部的に wait()システムコールを呼び出す wait 組み込みコマンドによって終了状態を得られる

## ゾンビプロセスと孤児プロセス

- 親プロセスが wait を行うまでの間、子プロセスは終了することができずに残っている
  - このようなプロセスをゾンビプロセスという
- プロセスの親が wait 系システムコールの実行前に終了した場合、当該プロセスは孤児プロセスとなる
- カーネルは init を孤児プロセスの新しい親にする
- ゾンビプロセスの親が終了したら init にゾンビプロセスが襲い掛かる
- init は定期的に wait()システムコールを実行してシステムのリソース回収を行っている
