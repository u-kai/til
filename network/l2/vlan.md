# VLAN

- IEEE802.1Q で規格化されている
- グループを一意に識別する番号は VLAN ID

## ポートベース VLAN

- この方式はスイッチングハブのポートごとに VLAN ID を割り当てる方式
- VLAN 機能を装備しているスイッチングハブのすべてのポートはデフォルトで VLAN ID が 0x1 の VLAN に収容されている
  - これをデフォルト VLAN という

## タグ VLAN

- ポートベース VLAN だと，VLAN ID ごとにポートや，他ポートと結ぶためのリンクが必要になる
- タグ VLAN では論理的にグループを識別できる

  - そのために VLAN タグフレームという特別なフレームを用いる
  - これは VLAN タグと呼ばれる 4 バイトのデータが挿入されたフレームで VLAN ID が挿入されている

- タグ VLAN を使用してネットワークを構成する場合，スイッチングハブのポートに対し，格納できる VLAN ID の値を事前に設定しておく必要がある

- VLAN タグフレームを送受信するポートをタグポートやトランクポートと呼ぶ
- トランクポート間の接続をトランク接続と呼ぶ
- トランクポートから送信されるとき，フレームには VLAN タグが挿入され，送信元ステーションが収容されている VLAN ID の値が格納される
- 対抗のトランクポートでフレームが受信されるとき，タグが取り除かれて VLAN ID の値が評価される
  - その後スイッチングハブ内の各 VLAN のアドレステーブルの値に従い，フレームが転送される

## VLAN タグ

- タグプロトコル識別子(TPID)
  - 2 バイト
  - 0x8100
  - フレームのタイプが IEEE802.1Q タグフレームであることを示している
  - このタグによって後続の 2 バイトをタグ制御識別しとして解釈する
- タグ制御識別子(TCI)
  - 2 バイト
    - 優先度
      - 3 ビット
      - CoS(Class Of Service)とも呼ばれ，0~7 の 8 段階ある
      - 特定の VLAN には属さないが優先度を設定したいときは VLAN ID を 0 に設定する
    - DEI(Drop Eligible Indicator)
      - 1 ビット
      - 1 である時，輻輳時に優先的に破棄しても良いフレーム
    - VLAN ID
      - 12 ビット
      - 0 の場合優先度タグと呼ばれる
- DIX 規格ではタイプ領域の前に VLAN タグが挿入される
- VLAN タグがつくことによってフレームの最大が 1522 バイトになる
