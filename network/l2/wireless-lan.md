# 無線 LAN

- IEEE802.11 により標準化されている
- アクセス制御方式として CSMA/CA を採用している

## 周波数帯域

- 障害物に強い 2.4GHz 帯と電波干渉が発生しずらい 5Ghz 帯がある
- 無線 LAN は割り当てられている帯域をチャネルに分割して使用している
- 2.4GHz は 13 チャネルに分割している
  - しかし各チャネルの波長が微妙に重なっているため，同時に使用できるチャネルが 3 つ(チャネル幅 22MHz)あるいは 4 つ(20MHz)に限られている
  - 2.4~2.4845GHz までが利用できるかんじ？
  - 同じ環境に 3 台のアクセスポイントがあり，それらに 1 チャネル，6 チャネル，11 チャネルを割り当てた時，アクセスポイントの電波が届く範囲が被っても衝突は起きない
  - 逆にいうと衝突が起きないチャネルを選んで配置するべしってかんじ？
  - 13 チャネルに分けられ流けど，多くても 3 つぐらいしか同時に使えないよってことかな
- 5GHz 帯は W52,W53,W56 という 3 つの周波数帯域で構成されている
  - W52,W53 は各 4 チャンネル W56 は 11 チャネルに分割されている -　各チャネルは完全に重ならない波長を使用しているため 19 チャネルすべてを利用することができる

## IEEE802.11n(Wi-Fi4)

- MIMO(Multiple Input Multiple Output)，チャネルボンディングなど，今日の無線 LAN 通信に欠かせない高速技術を採用した規格
- MIMO とは複数のアンテナを用いて同時に複数のストリームを通信することで高速化を図る技術
- IEEE802.11n を IEEE802.11a/g と同一環境で使用する場合，下位規格である IEEE802.11a/g 端末が上位規格である IEEE802.11n 端末のフレームを検知できるようにする必要がある

## IEEE802.11ac(Wi-Fi5),IEEE802.11ax(Wi-Fi8)

- MIMO を改良し，アクセスポイントと複数の端末が同時に MIMO 通信を行えるようになった MU-MIMO という

## チャネルボンディング

- 2 つのチャネルを束ねて高速化を図る手法

  - 1 つの AP で 2 つのチャネルを利用する
  - 2.4GHz でチャネルボンディングをすると，同時に 3 つしかチャネル使えないため，2 つの AP がある時点で干渉が起きてしまう
    - 2AP \* 2(チャネルボンディング) > MAX Chanel(3)
    - 複数の AP を配置する無線 LAN 環境でチャネルボンディングを使用する場合は 5GHz でやること

## バンドセレクト機能

- バンドステアリング機能とも呼ぶ
- デュアルバンドの端末を電波環境がクリーンな 5GHz 帯に誘導する機能

## DFS(Dynamic Frequency Selection)

- 航空官制レーダーなどの電波をキャッチしたら別のチャネルに切り替える機能
- これが機能すると AP との接続がきれ，通信ができなくなる

## アドホックモードとインフラストラクチャモード

- AP を使用するとき，ステーションの通信モードをインフラストラクチャモードに設定する
- AP を使用しない時，ステーションの通信モードをアドホックモードに設定する

## BSS(Basic Service Set),ESS(Extended Service Set)

- BSS

  - インフラストラクチャモードにおいては，1 台の AP で構成された無線 LAN のセグメント
  - アドホックモードでは通信し合う 1 対のステーションのみで構成された無線 LAN のセグメント
    - IBSS(Independent BSS)ともいう
  - BSS を識別するため 48 ビットの長さを持つ BSS ID が自動的に設定される
  - インフラストラクチャモードでは AP の MAC アドレスが BSS ID に採用される
  - アドホックモードでは AP を使用しないため BSS ID を生成する
    - I/G ビットが 0 で G/L ビットが 1 で残り 46 ビットが乱数
    - ステーションの MAC アドレスは I/G ビットが 0 で G/L ビットが 0 であり，マルチキャストアドレスは I/G ビットが 1 で G/L ビットが 0 なので BSS ID はどのアドレスとも重複しなくなる

- ESS

  - AP 同士を優先 LAN などで接続し，より大規模な無線 LAN セグメントを構成することを ESS という
  - AP 同士を結んだネットワークを DS(Distribution System)という
  - なお DS は一般に有線 LAN だが，AP 同士が無線 LAN で通信し合う Wireless DS(WDS)も構成可能
  - 同一環境に複数の ESS を構築することができ，ESS を識別する際に ESS ID を設定する
  - ESS ID は最大 32 文字の英数字で，SSID と呼ぶことが多い

- AP はビーコン信号を定期的に発信し，端末に存在を知らしめている
  - 通常そのビーコン信号に自分の SSID を格納しているので無線 LAN 端末は近隣の AP が走んしている SSID を受信し，利用者に表示している
  - このように端末が SSID を受動的に入手する方法をパッシブスキャンと呼ぶ
- SSID を指定せずに通信状態が最も良い AP に接続することも可能で，これを ANY 接続という

## AP のアクセス制御機能

- SSID 隠蔽(ステルス機能)

  - ビーコン信号を止める方法
  - SSID を最初から知っている正当な利用者のみ通信を行わせる

- ANY 接続拒否

  - SSID を指定した接続を強制させる
  - これにより，PSK 認証や RADIUS 認証に成功した利用者だけが無線 LAN 通信を行うことができる

- MAC アドレスフィルタリング

## CSMA/CA

- 無線 LAN は媒体共有型のネットワークであるため，複数のステーションが同時にフレームを送信すると衝突が起きる
- ステーション同士の位置関係によっては隠れ端末問題が発生するため衝突を検出できない可能性がある
- そこでアクセス制御方式として CSMA／CA が採用されている

  - これは衝突の検出ではなく，回避をしている
  - ACK 制御方式と RTS(Request to Send)／CTS(Clear to Send)制御方式の 2 つある

### ACK

- 通信ステーションは通信中のステーションが他にないことを確認する
- ステーションは送信前にランダム時間まつ

  - この期間をコンテンションウィンドウ，またはバックオフウィンドウという
  - この仕組みによって，通信待機から一斉に通信を行うことを防ぐ

- 送信ステーションはデータフレームを送信する

  - フレームのデュレーション領域には通信を予約する時間が格納される
  - この時間を NAV(Network Allocation Vector,ネットワーク割り当てベクタ)という
  - 他のステーションはフレームを受信すると NAV 値を更新し，その予約時間が満了するまで送信を行わない

- 正常に通信できたら AP は ACK フレームを送信ステーションに送信する
  - なお ACK フレームの NAV 値には 0 がセットされる
- 送信ステーションは ACK フレームを受信する

  - 一定期間内に ACK フレームを受信できなかった場合，通信障害が発生したと判断してフレームを再送する

- この方式は隠れ端末に対して NAV を提供できないため弱い
- フレームのサイズが大きい場合は衝突する可能性が高くなるので RTS/CTS 方式を使う

### RTS/CTS

- 送信ステーションは通信中のステーションが他にないことを確認する
- 送信する前にステーションはコンテンションウィンドウの時間待機する
- 送信ステーションは RTS フレームを送信し，AP に対しての送信権の獲得を要求する
  - フレームのデュレーション領域には RTS フレーム用の NAV 値が格納されている
- AP は当該ステーションに送信権を割り当てる

  - それを全てのステーションに通知するため，CTS フレームを送信する
  - 全てのステーションは AP とは通信できるので，CTS フレームを受信する
  - フレームのデュレーション領域には CTS フレーム用の NAV 値が格納される

- 送信ステーションは CTS フレームを受信し，自分が送信権を獲得したことを確認する

  - 残りのステーションは当該ステーションが送信権を獲得したことを知る

- 送信ステーションはデータフレームを送信する
- 正常に通信できたら AP は ACK フレームを送信ステーションに返信する
- 送信ステーションは ACK フレームを受信する

## フレームフォーマット

- 伝送速度の違う下位規格のステーションと同じチャネルを共有する時，下位規格の方が識別できるように物理層ヘッダを送信するときの速度は上位規格が下位規格に合わせる
- データリンク層以上のは上位規格本来の速度で伝送する

## フレーム制御，デュレーション／ID

- フレーム制御領域はフレームのタイプ(管理用／制御用／データ用) WEP 暗号化の有無，ToDS,FromDS などを特定する
- ToDS
  - 0 の時は宛先がステーション
  - 1 の時は宛先が AP
- FromDS
  - 0 の時は送信もとがステーション
  - 1 の時は送信もとが AP

## フレームアグリゲーション

- 宛先が同じ複数のフレームを束ねて送信する技術
- CSMA/CA 方式では送信ステーションがフレームを送信するたびに受信ステーションは確認応答を返信する仕組みになっており，フレームを送信するたびに確認応答が発生し，スループットが低下する

## 下位規格との混在環境における衝突回避

- 衝突回避のためにはあるステーションが送信したフレームを他のステーションが受信できる必要があるため，上位企画が下位規格に速度を合わせる必要がある
- IEEE802.11n には IEEE802.11a/g との混在環境に対応した mixed mode が規定されている
  - mixed mode では IEEE802.11a/g と同じプリアンブルを付加して送信する
  - このプリアンブルは IEEE802.11a/g ステーションが解釈できる OFDM 方式のフォーマット
  - OFDM 方式ではプリアンブルの中に格納されている情報だけを読み取ればどれほどの期間送信を控えるべきかがわかるようになっている
  - mixed mode では IEEE802.11a/g がプリアンブルの後ろを見て衝突を回避する必要がないため，プリアンブルの後ろからは高速に伝送することができる

## ローミング機能

- ステーションが移動しても通信が切れないようにする仕組み
  - 移動しながら最寄りの AP に自動的に接続する機能
  - ステーションおよびローミングの移動範囲に配置された全ての AP は同一の ESS に属している必要がある

## バーチャル AP 機能

- 1 台の AP の上で複数の仮想的な AP を稼働させる機能
- 個別に ESS ID や VLAN を割り当てることが可能

## アクセス制御機能

- SSID 隠蔽
- ANY 接続拒否
- MAC アドレスフィルタリング

## 認証機能

- RADIUS など

## 無線 LAN コントローラ(WLC)

- 複数の AP を一元管理する機器
- WLC とその管理下にある AP は製造元が同じケースが多い
- 管理用の通信を行うため IP アドレスをもつ
- 以下のような機能を持つ

  - AP の設定情報の管理と更新
    - WLS から AP に設定情報を配信して更新する
  - AP の監視
  - AP の電波干渉の検知と回避

    - 電波干渉を検知し，AP のチャネルを適宜変更して電波干渉を回避してくれる

  - AP の負荷分散
  - セキュリティ機能とローミング機能の強化
    - 個々の AP が認証処理を実行するのではなく WLC が実行する
    - PMK を WLC にキャッシュさせれば，ローミングの処理が高速化される
  - DHCP
    - 管理下にある AP に対して，IP アドレス，サブネットマスク，デフォルトゲートウェイなどのネットワーク情報を自動的に設定する機能を持つ
