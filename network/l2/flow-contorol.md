# フロー制御

## IEEE802.3x

- イーサネットの全二重モードにおけるフロー制御方式を規定したもの
- 副層を検知したスイッチングハブはフレームを送信している端末やスイッチングハブに対し，PAUSE フレームを送出する
- PAUSE フレームを受け取ったら一定期間フレームの送信を延期する仕組みになっている
  - フレームの中に停止時間が格納されている
  - DIX 規格で宛先 MAC アドレスは 01-80-02-00-00-01(フラッディングされないマルチキャストアドレス)送信もと MAC アドレスは送信もとステーションの MAC アドレス，タイプ領域の値は 0x8808

## バックプレッシャ方式

- 半二重モードにはフロー制御に関する標準規格は存在しないが多くはこの方式を利用している
- これは衝突を検知すると，フレームを送信している端末に対して架空のジャム信号を送出する
- 半二重モードでは nCSMA／CD の仕組みによって，ジャム信号を受け取った送信ステーションはバックお h じかんがけいかするまでフレームの送信を延期する

## オートネゴシエーション

- 1 代のスイッチに 10BASE-T,100BASE-TX,1000BASE-T のステーションを収容する場合，スイッチングハブの各ポートとステーションの間で，伝送速度と伝送モード(全二重／半二重)を同一にする必要がある
- これを自動敵に判別して設定する仕組みがオートネゴシエーション
- オートネゴシエーションは専用の制御フレームではなく，リンクパルスを使って制御を行っている

  - リンクパルス
    - イーサネット上で通信機器同士が互いの接続性を常時確認するためにアイドル期間中に送信するパルス信号のこと
    - 10BASE-T では NLP(Normal Link Pulse)
    - 100BASE-TX ではアイドル信号を常時やりとりしている
    - NLP とアイドル信号は周波数や電圧が異なるため通信速度の相違を自動認識できる
    - ただし全二重／半二重の相違は判別できない

- オートネゴシエーションに対応している機器の場合，NLP と同時に FLP バースト(Fast Link Pulse)と呼ばれる NLP よりもパルスはばが遥かに小さいにパルスを送信する

  - これは NLP の送信に相乗りさせている
  - FLP に載せて自分がサポートする伝送速度／伝送モードを相手に伝える
  - 自分と相手がサポートする伝送速度と伝送モードのうち最も優先度の高いものが選択されてオートネゴシエーションを完遂する
  - その後 FLP バーストは送信されなくなる

- オートネゴシエーション機能がやりとりする一方で無効になっている時，有効な側は FLP を受信しないため，相手が全二重に対応していないと判断する
- そのため全二重でやり取りを行いたい場合は，両方の機器でオートネゴシエーションを有効にするか無効にして手動で伝送速度と伝送モードを設定する必要がある

## オート MDI/MDI-X

- IEEE によって標準化されたものではないが，一部のスイッチングハブが持っている機能
- これはポートに接続されたツイストペアケーブルがストレートかクロスかを自動的に判断して，Tx と Rx の極性の違いをポート側で吸収する機能
- これがないと相手と繋げるケーブルがストレートなのかクロスなのか，相手の物理ポートは MDI なのか MDI-X なのか気にしなくてはいけない

## 1000BASE-SX/1000BASE-LX

- これらのケーブルは通常は全二重および 1G ビット/s であるため，オートネゴシエーションを使用する必要はない
- しかし，オートネゴシエーションの規格に含まれるリモートフォルト機能を用いるためにオートネゴシエーションを使用するケースがある
- 光ファイバでは 2 芯あるファイバのうち 1 芯だけが切断するという障害が発生することがある
- このとき一方のスイッチングハブではリンクダウンを検出するが，送信側はリンクアップのままという単方向通信状態に陥る
- リモートフォルト機能を動作させることにより，両端の装置で障害を検知し，リンクダウンさせることができる
