---
marp: true
---

# コンテナ

---

# 仮想マシンとの違い

- 大きな目的は同じ

  - それぞれの中に独立したプロセス実行環境を提供する目的

- しかしプロセスの下にあるカーネル以下のレイヤに大きな違いがある
- 仮想マシンは個々の仮想マシン専用の仮想的なハードウェアとカーネルがエミュレートされる
- コンテナはコンテナを動かすホスト OS と全コンテナが 1 つのカーネルを共有する

  - つまり，ハードウェアとカーネルはエミュレートされない？

- このためコンテナは Linux カーネル上で動作するシステムだけを動かすことができる
- コンテナはコンテナランタイムと呼ばれるプロセスがコンテナを作った上で最初のプロセスを起動するだけ

---

# コンテナのいいところ

- 起動速度

  - コンテナはホスト OS のカーネルを共有するため，仮想マシンと違ってエミュレートする層が少なく起動が速い
  - 参考書では仮想マシンの軌道に 14 秒，コンテナの軌道に 0.670 秒となっていた

- ハードウェアへのアクセス速度
  - 仮想マシンはハードウェアをエミュレートするため，ハードウェアへのアクセスが遅い
    - また，仮想マシン上のハードウェアアクセス → ホスト OS のハードウェアアクセスというように経由するものが多い
  - コンテナの場合はホスト OS のカーネルを共有するため，コンテナがハードウェアにカーネル経由ですぐにハードウェアへのアクセスでき，速い

---

# 仮想マシンのいいところ

- 仮想化ソフトウェアがエミュレートできる OS であれば何でも起動することができる
  - コンテナはホスト OS のカーネルを共有するため，ホスト OS と同じ OS しか起動できない
- 仮想マシンごとの分離が強い
  - 仮想化マシンはハードウェアからの層をエミュレートするため，ホスト OS との分離が強い
    - 一つの仮想マシンを攻撃されても，その影響範囲はその仮想マシンの仮想ハードウェアに止まることが多い
  - コンテナはホスト OS のカーネルを共有するため，ホスト OS のカーネルに脆弱性があるとコンテナにも影響が出る
  - 疑問
    - ただし，最終的にはホスト OS の力を借りるはずなので，ホスト OS の脆弱性があると仮想マシンにも影響が出る可能性はありそうな気がする

---

# namespace

- コンテナを実現するためのカーネルの 1 機能
- namespace はシステムに存在する様々な種類のリソースについて存在し，所属するプロセスに見掛け上は独立したリソースを見せる機能
- pid namespace
  - 独立した pid 名前空間を見せる
- user namespace
  - 独立した uid,gid を見せる
- mount namespace
  - 独立したファイルシステムマウント状況を見せる

---

# pid namespace

- システム起動時には全てのプロセスが所属する root pid ns というものが存在する
- プロセス A，B,C があると，プロセス A は B, C を pid2,3 などと認識できる
- しかし，新しく，pid ns foo のよな namespace を作ると親の root pid ns から pid ns foo に存在するプロセスは見えるが，pid ns foo に存在するプロセスは親の root pid ns に存在するプロセスは見えない

---

# コンテナの正体

- 独立した namespace を持つことによって他のプロセスと実行環境が分かれている 1 つないし複数のプロセスがコンテナ
- 独立したとは，pid namespace として独立しても user namespace として独立しても，mount namespace として独立しても，ということ
  - いろんな種類があるらしい
- 分離された namespace 内のコンテナは親を含む他の namespace を見ることができない

---

# セキュリティリスク
